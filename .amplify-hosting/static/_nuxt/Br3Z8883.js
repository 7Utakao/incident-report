import{c as b,o as y,a as t,e as j,r as C,i as P,m as O,F as T,j as A,D as V,t as k,b as x,h as M,H as L,d as D,w as $,k as ee,f as te,u as se,E as ae,l as X,s as re}from"./BBGXoVXL.js";import{C as q}from"./CtuzsKz4.js";import{C as K}from"./f9QzHCjA.js";import{B as S}from"./0OkAVhSL.js";import{I as R}from"./C-IanVnj.js";import{g as ne,S as oe,a as le,b as ie}from"./CG-XnF2P.js";import{B as ue}from"./DhJe92nY.js";import{u as de}from"./CdiFBCIm.js";import{t as I,c as ce,n as F,g as Y,a as fe,e as ge,m as H,b as z,f as me,j as U}from"./C3bHKmRd.js";import"./CJ8rfh6T.js";import"./Dzv0W22B.js";function B(l,i){const e=+I(l)-+I(i);return e<0?-1:e>0?1:e}function pe(l){return ce(l,Date.now())}function ve(l,i,e){const[h,s]=F(e?.in,l,i),r=h.getFullYear()-s.getFullYear(),_=h.getMonth()-s.getMonth();return r*12+_}function ye(l){return i=>{const h=(l?Math[l]:Math.trunc)(i);return h===0?0:h}}function he(l,i){return+I(l)-+I(i)}function be(l,i){const e=I(l,i?.in);return e.setHours(23,59,59,999),e}function xe(l,i){const e=I(l,i?.in),h=e.getMonth();return e.setFullYear(e.getFullYear(),h+1,0),e.setHours(23,59,59,999),e}function we(l,i){const e=I(l,i?.in);return+be(e,i)==+xe(e,i)}function _e(l,i,e){const[h,s,r]=F(e?.in,l,l,i),_=B(s,r),d=Math.abs(ve(s,r));if(d<1)return 0;s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-_*d);let a=B(s,r)===-_;we(h)&&d===1&&B(h,r)===1&&(a=!1);const u=_*(d-+a);return u===0?0:u}function ke(l,i,e){const h=he(l,i)/1e3;return ye(e?.roundingMethod)(h)}function $e(l,i,e){const h=fe(),s=e?.locale??h.locale??ge,r=2520,_=B(l,i);if(isNaN(_))throw new RangeError("Invalid time value");const d=Object.assign({},e,{addSuffix:e?.addSuffix,comparison:_}),[a,u]=F(e?.in,..._>0?[i,l]:[l,i]),m=ke(u,a),o=(Y(u)-Y(a))/1e3,n=Math.round((m-o)/60);let g;if(n<2)return e?.includeSeconds?m<5?s.formatDistance("lessThanXSeconds",5,d):m<10?s.formatDistance("lessThanXSeconds",10,d):m<20?s.formatDistance("lessThanXSeconds",20,d):m<40?s.formatDistance("halfAMinute",0,d):m<60?s.formatDistance("lessThanXMinutes",1,d):s.formatDistance("xMinutes",1,d):n===0?s.formatDistance("lessThanXMinutes",1,d):s.formatDistance("xMinutes",n,d);if(n<45)return s.formatDistance("xMinutes",n,d);if(n<90)return s.formatDistance("aboutXHours",1,d);if(n<H){const v=Math.round(n/60);return s.formatDistance("aboutXHours",v,d)}else{if(n<r)return s.formatDistance("xDays",1,d);if(n<z){const v=Math.round(n/H);return s.formatDistance("xDays",v,d)}else if(n<z*2)return g=Math.round(n/z),s.formatDistance("aboutXMonths",g,d)}if(g=_e(u,a),g<12){const v=Math.round(n/z);return s.formatDistance("xMonths",v,d)}else{const v=g%12,w=Math.trunc(g/12);return v<3?s.formatDistance("aboutXYears",w,d):v<9?s.formatDistance("overXYears",w,d):s.formatDistance("almostXYears",w+1,d)}}function De(l,i){return $e(l,pe(l),i)}function Me(l,i){return y(),b("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z","clip-rule":"evenodd"})])}function Ce(l,i){return y(),b("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z","clip-rule":"evenodd"})])}function Pe(l,i){return y(),b("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z","clip-rule":"evenodd"})])}function Se(l,i){return y(),b("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M9.47 6.47a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 1 1-1.06 1.06L10 8.06l-3.72 3.72a.75.75 0 0 1-1.06-1.06l4.25-4.25Z","clip-rule":"evenodd"})])}const Ve={class:"overflow-hidden rounded-token-lg border border-gray-200 bg-white"},Ie={key:0,class:"p-8 text-center"},Oe={key:1,class:"overflow-x-auto"},Te={class:"min-w-full divide-y divide-gray-200"},ze={class:"bg-gray-50"},Ae=["onClick"],Be={class:"flex items-center space-x-1"},Le={key:0,class:"flex flex-col"},Re={key:0,class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},je={class:"bg-white divide-y divide-gray-200"},Fe=["onClick"],Ne={key:0,class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Xe={key:0},qe=["colspan"],Ke=j({__name:"Table",props:{columns:{},data:{},loading:{type:Boolean,default:!1},rowClickable:{type:Boolean,default:!1},defaultSortKey:{},defaultSortOrder:{default:"asc"},rowKey:{}},emits:["row-click","sort"],setup(l,{emit:i}){const e=l,h=i,s=C(e.defaultSortKey||""),r=C(e.defaultSortOrder),_=P(()=>s.value?[...e.data].sort((o,n)=>{const g=a(o,s.value),v=a(n,s.value);if(g===v)return 0;const w=g<v?-1:1;return r.value==="asc"?w:-w}):e.data),d=o=>{s.value===o?r.value=r.value==="asc"?"desc":"asc":(s.value=o,r.value="asc"),h("sort",s.value,r.value)},a=(o,n)=>n.split(".").reduce((g,v)=>g?.[v],o),u=(o,n)=>o==null?"-":n.formatter?n.formatter(o):String(o),m=(o,n)=>typeof e.rowKey=="function"?e.rowKey(o,n):typeof e.rowKey=="string"?a(o,e.rowKey)||n:o.id||n;return(o,n)=>(y(),b("div",Ve,[o.loading?(y(),b("div",Ie,n[0]||(n[0]=[t("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"},null,-1),t("p",{class:"mt-2 text-gray"},"読み込み中...",-1)]))):(y(),b("div",Oe,[t("table",Te,[t("thead",ze,[t("tr",null,[(y(!0),b(T,null,A(o.columns,g=>(y(),b("th",{key:g.key,class:V(["px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",g.sortable?"cursor-pointer hover:bg-gray-100 select-none":""]),onClick:v=>g.sortable?d(g.key):null},[t("div",Be,[t("span",null,k(g.label),1),g.sortable?(y(),b("div",Le,[x(M(Se),{class:V(["h-3 w-3",s.value===g.key&&r.value==="asc"?"text-primary-600":"text-gray-300"])},null,8,["class"]),x(M(Me),{class:V(["h-3 w-3 -mt-1",s.value===g.key&&r.value==="desc"?"text-primary-600":"text-gray-300"])},null,8,["class"])])):O("",!0)])],10,Ae))),128)),o.$slots.actions?(y(),b("th",Re," 操作 ")):O("",!0)])]),t("tbody",je,[(y(!0),b(T,null,A(_.value,(g,v)=>(y(),b("tr",{key:m(g,v),class:V(["hover:bg-gray-50 transition-colors duration-150",o.rowClickable?"cursor-pointer":""]),onClick:w=>o.rowClickable?o.$emit("row-click",g,v):null},[(y(!0),b(T,null,A(o.columns,w=>(y(),b("td",{key:w.key,class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},[L(o.$slots,`cell-${w.key}`,{item:g,value:a(g,w.key),index:v},()=>[D(k(u(a(g,w.key),w)),1)])]))),128)),o.$slots.actions?(y(),b("td",Ne,[L(o.$slots,"actions",{item:g,index:v})])):O("",!0)],10,Fe))),128)),_.value.length===0?(y(),b("tr",Xe,[t("td",{colspan:o.columns.length+(o.$slots.actions?1:0),class:"px-6 py-12 text-center text-gray-500"},[L(o.$slots,"empty",{},()=>[n[1]||(n[1]=t("div",{class:"text-center"},[t("p",{class:"text-lg font-medium"},"データがありません"),t("p",{class:"text-sm mt-1"},"条件を変更して再度お試しください")],-1))])],8,qe)])):O("",!0)])])]))]))}}),Ye=Object.assign(Ke,{__name:"UiTable"}),He={class:"flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6"},Ue={class:"flex flex-1 justify-between sm:hidden"},Ee={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},Ze={class:"text-sm text-gray-700"},Ge={class:"font-medium"},Je={class:"font-medium"},Qe={class:"font-medium"},We={class:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},et=["disabled"],tt=["onClick"],st={key:1,class:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700 ring-1 ring-inset ring-gray-300"},at=["disabled"],rt=j({__name:"Pagination",props:{currentPage:{},totalPages:{},total:{},perPage:{},maxVisiblePages:{default:7}},emits:["page-change"],setup(l,{emit:i}){const e=l,h=i,s=P(()=>(e.currentPage-1)*e.perPage+1),r=P(()=>Math.min(e.currentPage*e.perPage,e.total)),_=P(()=>{const a=[],{currentPage:u,totalPages:m,maxVisiblePages:o}=e;if(m<=o)for(let n=1;n<=m;n++)a.push(n);else{a.push(1);const n=Math.max(2,u-Math.floor(o/2)),g=Math.min(m-1,n+o-3);n>2&&a.push("...");for(let v=n;v<=g;v++)a.push(v);g<m-1&&a.push("..."),m>1&&a.push(m)}return a}),d=a=>{a>=1&&a<=e.totalPages&&a!==e.currentPage&&h("page-change",a)};return(a,u)=>(y(),b("nav",He,[t("div",Ue,[x(S,{variant:"secondary",size:"sm",disabled:a.currentPage<=1,onClick:u[0]||(u[0]=m=>d(a.currentPage-1))},{default:$(()=>u[4]||(u[4]=[D(" 前へ ",-1)])),_:1,__:[4]},8,["disabled"]),x(S,{variant:"secondary",size:"sm",disabled:a.currentPage>=a.totalPages,onClick:u[1]||(u[1]=m=>d(a.currentPage+1))},{default:$(()=>u[5]||(u[5]=[D(" 次へ ",-1)])),_:1,__:[5]},8,["disabled"])]),t("div",Ee,[t("div",null,[t("p",Ze,[t("span",Ge,k(s.value),1),u[6]||(u[6]=D(" から ",-1)),t("span",Je,k(r.value),1),u[7]||(u[7]=D(" 件目を表示（全 ",-1)),t("span",Qe,k(a.total),1),u[8]||(u[8]=D(" 件中） ",-1))])]),t("div",null,[t("nav",We,[t("button",{disabled:a.currentPage<=1,class:V(["relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",a.currentPage<=1?"cursor-not-allowed opacity-50":"hover:text-gray-500 focus-ring"]),onClick:u[2]||(u[2]=m=>d(a.currentPage-1))},[u[9]||(u[9]=t("span",{class:"sr-only"},"前のページ",-1)),x(M(Ce),{class:"h-5 w-5","aria-hidden":"true"})],10,et),(y(!0),b(T,null,A(_.value,m=>(y(),b(T,{key:m},[typeof m=="number"?(y(),b("button",{key:0,class:V(["relative inline-flex items-center px-4 py-2 text-sm font-semibold ring-1 ring-inset ring-gray-300 focus:z-20 focus:outline-offset-0",m===a.currentPage?"z-10 bg-primary-600 text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600":"text-gray-900 hover:bg-gray-50 focus-ring"]),onClick:o=>d(m)},k(m),11,tt)):(y(),b("span",st," ... "))],64))),128)),t("button",{disabled:a.currentPage>=a.totalPages,class:V(["relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",a.currentPage>=a.totalPages?"cursor-not-allowed opacity-50":"hover:text-gray-500 focus-ring"]),onClick:u[3]||(u[3]=m=>d(a.currentPage+1))},[u[10]||(u[10]=t("span",{class:"sr-only"},"次のページ",-1)),x(M(Pe),{class:"h-5 w-5","aria-hidden":"true"})],10,at)])])])]))}}),nt=Object.assign(rt,{__name:"UiPagination"}),ot={class:"min-h-screen bg-background"},lt={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},it={class:"flex justify-between items-center mb-8"},ut={class:"text-3xl font-bold text-secondary"},dt={class:"mt-2 text-gray"},ct={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end"},ft={class:"flex justify-between items-center mt-4 pt-4 border-t border-gray-200"},gt={class:"text-sm text-gray"},mt={class:"flex space-x-2"},pt={class:"max-w-xs"},vt={class:"font-medium text-secondary truncate"},yt={class:"text-sm text-gray truncate"},ht={class:"text-sm"},bt={class:"text-xs text-gray"},xt={class:"flex space-x-2"},wt={key:0,class:"mt-6"},Tt=j({__name:"index",setup(l){const i=C(!0),e=C([]),h=C(1),s=C(10),r=C({q:"",category:"",from:"",to:""}),_=ne(),d=[{key:"title",label:"タイトル",sortable:!0},{key:"category",label:"カテゴリ",sortable:!0},{key:"author",label:"作成者",sortable:!0},{key:"createdAt",label:"作成日時",sortable:!0}],a=C("user-123"),u=P(()=>e.value.length),m=P(()=>{let p=e.value;if(r.value.q){const c=r.value.q.toLowerCase();p=p.filter(f=>f.title.toLowerCase().includes(c)||f.summary.toLowerCase().includes(c))}return r.value.category&&(p=p.filter(c=>c.category===r.value.category)),r.value.from&&(p=p.filter(c=>new Date(c.createdAt)>=new Date(r.value.from))),r.value.to&&(p=p.filter(c=>new Date(c.createdAt)<=new Date(r.value.to+"T23:59:59"))),p}),o=P(()=>Math.ceil(m.value.length/s.value)),n=P(()=>{const p=(h.value-1)*s.value,c=p+s.value;return m.value.slice(p,c)}),g=p=>me(new Date(p),"yyyy/MM/dd HH:mm",{locale:U}),v=p=>De(new Date(p),{addSuffix:!0,locale:U}),w=()=>{h.value=1},E=p=>{h.value=p},Z=p=>{re(`/reports/${p.id}`)},G=p=>{console.log("Edit report:",p.id)},J=()=>{r.value={q:"",category:"",from:"",to:""}},Q=()=>{console.log("Export reports")},N=async()=>{try{i.value=!0;const{reports:p}=de(),c=await p.list({q:r.value.q,category:r.value.category,from:r.value.from,to:r.value.to});e.value=c.items.map(f=>({id:f.reportId,title:f.title||"無題",summary:f.summary||f.body?.substring(0,100)+"..."||"",category:f.category,status:"完了",author:"ユーザー",userId:f.userId,createdAt:f.createdAt,updatedAt:f.createdAt}))}catch(p){console.error("Failed to fetch reports:",p),e.value=[]}finally{i.value=!1}};return ee(r,()=>{h.value=1},{deep:!0}),te(()=>{N()}),window.addEventListener("focus",()=>{N()}),se({title:"報告一覧 - 報告システム"}),(p,c)=>(y(),b("div",ot,[t("div",lt,[t("div",it,[t("div",null,[t("h1",ut,k(M(q).listTitle),1),t("p",dt,k(M(q).listSubtitle),1)]),x(S,{variant:"primary",onClick:c[0]||(c[0]=f=>p.$router.push("/reports/new"))},{default:$(()=>c[5]||(c[5]=[D(" 新しい報告を作成 ",-1)])),_:1,__:[5]})]),x(K,{class:"mb-6"},{default:$(()=>[t("div",ct,[t("div",null,[x(R,{modelValue:r.value.q,"onUpdate:modelValue":c[1]||(c[1]=f=>r.value.q=f),placeholder:"タイトルや内容で検索...",onInput:w},null,8,["modelValue"])]),t("div",null,[x(oe,{modelValue:r.value.category,"onUpdate:modelValue":[c[2]||(c[2]=f=>r.value.category=f),w],options:M(_),placeholder:"カテゴリを選択"},null,8,["modelValue","options"])]),t("div",null,[x(R,{modelValue:r.value.from,"onUpdate:modelValue":c[3]||(c[3]=f=>r.value.from=f),type:"date",label:"開始日",onInput:w},null,8,["modelValue"])]),t("div",null,[x(R,{modelValue:r.value.to,"onUpdate:modelValue":c[4]||(c[4]=f=>r.value.to=f),type:"date",label:"終了日",onInput:w},null,8,["modelValue"])])]),t("div",ft,[t("div",gt,k(u.value)+" 件中 "+k(m.value.length)+" 件を表示 ",1),t("div",mt,[x(S,{variant:"ghost",size:"sm",onClick:J},{default:$(()=>c[6]||(c[6]=[D(" フィルタをクリア ",-1)])),_:1,__:[6]}),x(S,{variant:"secondary",size:"sm",onClick:Q},{default:$(()=>c[7]||(c[7]=[D(" 検索 ",-1)])),_:1,__:[7]})])])]),_:1}),x(K,null,{default:$(()=>[x(Ye,{columns:d,data:n.value,loading:i.value,"row-clickable":"",onRowClick:Z},{"cell-title":$(({item:f})=>[t("div",pt,[t("div",vt,k(f.title),1),t("div",yt,k(f.summary),1)])]),"cell-category":$(({item:f})=>[x(ue,{variant:M(le)(f.category)},{default:$(()=>[D(k(M(ie)(f.category)),1)]),_:2},1032,["variant"])]),"cell-createdAt":$(({item:f})=>[t("div",ht,[t("div",null,k(g(f.createdAt)),1),t("div",bt,k(v(f.createdAt)),1)])]),actions:$(({item:f})=>[t("div",xt,[x(S,{variant:"ghost",size:"sm",onClick:X(W=>p.$router.push(`/reports/${f.id}`),["stop"])},{default:$(()=>c[8]||(c[8]=[D(" 詳細 ",-1)])),_:2,__:[8]},1032,["onClick"]),f.userId===a.value?(y(),ae(S,{key:0,variant:"ghost",size:"sm",onClick:X(W=>G(f),["stop"])},{default:$(()=>c[9]||(c[9]=[D(" 編集 ",-1)])),_:2,__:[9]},1032,["onClick"])):O("",!0)])]),_:1},8,["data","loading"]),o.value>1?(y(),b("div",wt,[x(nt,{"current-page":h.value,"total-pages":o.value,total:m.value.length,"per-page":s.value,onPageChange:E},null,8,["current-page","total-pages","total","per-page"])])):O("",!0)]),_:1})])]))}});export{Tt as default};
