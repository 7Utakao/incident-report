import{a8 as D,a9 as Bt,aa as qt,ab as P,ac as O,ad as Ht,ae as Wt,af as zt,ag as te,ah as ne,ai as oe,aj as se,ak as ie,al as je,am as N,an as Nt,ao as be,ap as Le,aq as Kt,ar as $t,as as q,at as Vt,au as jt,av as Yt,aw as vt,ax as Te,ay as f,az as I,aA as C,aB as wt,aC as Jt,aD as Gt,aE as ae,aF as Zt,aG as Xt,aH as _t,aI as Qt,aJ as en,aK as tn,aL as nn,aM as on,aN as pe,r as re,s as sn}from"./BBGXoVXL.js";const an=(e,t)=>e.Auth.fetchAuthSession(t),rn=e=>an(D,e);function Mt(){return D.Auth.clearCredentials()}const cn=async()=>{const{userAgentData:e}=navigator;if(!e)return navigator.userAgent;const{platform:t="",platformVersion:n="",model:o="",architecture:i="",fullVersionList:s=[]}=await e.getHighEntropyValues(["platform","platformVersion","architecture","model","fullVersionList"]),a=s.map(c=>`${c.brand}/${c.version}`).join(";");return[t,n,i,o,t,a].filter(c=>c).join(" ")||navigator.userAgent};function ln(e){return Array.from(e,t=>String.fromCodePoint(t)).join("")}const ge={convert(e,t={urlSafe:!1,skipPadding:!1}){const n=typeof e=="string"?e:ln(e);let o=Bt()(n);return t.urlSafe&&(o=o.replace(/\+/g,"-").replace(/\//g,"_")),t.skipPadding&&(o=o.replace(/=/g,"")),o}};function dn(){return qt().getRandomValues(new Uint32Array(1))[0]}function un(e){const{words:t}=e,{sigBytes:n}=e,o=[];for(let i=0;i<n;i++){const s=t[i>>>2]>>>24-i%4*8&255;o.push((s>>>4).toString(16)),o.push((s&15).toString(16))}return o.join("")}class ke{constructor(t,n){this.words=[];let o=t;o=this.words=o||[],n!==void 0?this.sigBytes=n:this.sigBytes=o.length*4}random(t){const n=[];for(let o=0;o<t;o+=4)n.push(dn());return new ke(n,t)}toString(){return un(this)}}var g;(function(e){e.EmptySignInUsername="EmptySignInUsername",e.EmptySignInPassword="EmptySignInPassword",e.CustomAuthSignInPassword="CustomAuthSignInPassword",e.EmptySignUpUsername="EmptySignUpUsername",e.EmptySignUpPassword="EmptySignUpPassword",e.EmptyConfirmSignUpUsername="EmptyConfirmSignUpUsername",e.EmptyConfirmSignUpCode="EmptyConfirmSignUpCode",e.EmptyResendSignUpCodeUsername="EmptyresendSignUpCodeUsername",e.EmptyChallengeResponse="EmptyChallengeResponse",e.EmptyConfirmResetPasswordUsername="EmptyConfirmResetPasswordUsername",e.EmptyConfirmResetPasswordNewPassword="EmptyConfirmResetPasswordNewPassword",e.EmptyConfirmResetPasswordConfirmationCode="EmptyConfirmResetPasswordConfirmationCode",e.EmptyResetPasswordUsername="EmptyResetPasswordUsername",e.EmptyVerifyTOTPSetupCode="EmptyVerifyTOTPSetupCode",e.EmptyConfirmUserAttributeCode="EmptyConfirmUserAttributeCode",e.IncorrectMFAMethod="IncorrectMFAMethod",e.EmptyUpdatePassword="EmptyUpdatePassword"})(g||(g={}));const En={[g.EmptyChallengeResponse]:{message:"challengeResponse is required to confirmSignIn"},[g.EmptyConfirmResetPasswordUsername]:{message:"username is required to confirmResetPassword"},[g.EmptyConfirmSignUpCode]:{message:"code is required to confirmSignUp"},[g.EmptyConfirmSignUpUsername]:{message:"username is required to confirmSignUp"},[g.EmptyConfirmResetPasswordConfirmationCode]:{message:"confirmationCode is required to confirmResetPassword"},[g.EmptyConfirmResetPasswordNewPassword]:{message:"newPassword is required to confirmResetPassword"},[g.EmptyResendSignUpCodeUsername]:{message:"username is required to confirmSignUp"},[g.EmptyResetPasswordUsername]:{message:"username is required to resetPassword"},[g.EmptySignInPassword]:{message:"password is required to signIn"},[g.EmptySignInUsername]:{message:"username is required to signIn"},[g.EmptySignUpPassword]:{message:"password is required to signUp"},[g.EmptySignUpUsername]:{message:"username is required to signUp"},[g.CustomAuthSignInPassword]:{message:"A password is not needed when signing in with CUSTOM_WITHOUT_SRP",recoverySuggestion:"Do not include a password in your signIn call."},[g.IncorrectMFAMethod]:{message:"Incorrect MFA method was chosen. It should be either SMS, TOTP, or EMAIL",recoverySuggestion:"Try to pass SMS, TOTP, or EMAIL as the challengeResponse"},[g.EmptyVerifyTOTPSetupCode]:{message:"code is required to verifyTotpSetup"},[g.EmptyUpdatePassword]:{message:"oldPassword and newPassword are required to changePassword"},[g.EmptyConfirmUserAttributeCode]:{message:"confirmation code is required to confirmUserAttribute"}};var Ye;(function(e){e.DEFAULT_MSG="Authentication Error",e.EMPTY_EMAIL="Email cannot be empty",e.EMPTY_PHONE="Phone number cannot be empty",e.EMPTY_USERNAME="Username cannot be empty",e.INVALID_USERNAME="The username should either be a string or one of the sign in types",e.EMPTY_PASSWORD="Password cannot be empty",e.EMPTY_CODE="Confirmation code cannot be empty",e.SIGN_UP_ERROR="Error creating account",e.NO_MFA="No valid MFA method provided",e.INVALID_MFA="Invalid MFA type",e.EMPTY_CHALLENGE="Challenge response cannot be empty",e.NO_USER_SESSION="Failed to get the session because the user is empty",e.NETWORK_ERROR="Network Error",e.DEVICE_CONFIG="Device tracking has not been configured in this User Pool",e.AUTOSIGNIN_ERROR="Please use your credentials to sign in",e.OAUTH_ERROR="Couldn't finish OAuth flow, check your User Pool HostedUI settings"})(Ye||(Ye={}));var z;(function(e){e.SignInException="SignInException",e.OAuthSignInError="OAuthSignInException"})(z||(z={}));function v(e,t){const{message:n,recoverySuggestion:o}=En[t];if(!e)throw new P({name:t,message:n,recoverySuggestion:o})}var Je;(function(e){e.ConcurrentModificationException="ConcurrentModificationException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.SoftwareTokenMFANotFoundException="SoftwareTokenMFANotFoundException"})(Je||(Je={}));var Ge;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.InvalidPasswordException="InvalidPasswordException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Ge||(Ge={}));var Ze;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidPasswordException="InvalidPasswordException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UsernameExistsException="UsernameExistsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Ze||(Ze={}));var Xe;(function(e){e.CodeMismatchException="CodeMismatchException",e.ExpiredCodeException="ExpiredCodeException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidPasswordException="InvalidPasswordException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyFailedAttemptsException="TooManyFailedAttemptsException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Xe||(Xe={}));var Qe;(function(e){e.AliasExistsException="AliasExistsException",e.CodeMismatchException="CodeMismatchException",e.ExpiredCodeException="ExpiredCodeException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyFailedAttemptsException="TooManyFailedAttemptsException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotFoundException="UserNotFoundException"})(Qe||(Qe={}));var et;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(et||(et={}));var tt;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(tt||(tt={}));var nt;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(nt||(nt={}));var ot;(function(e){e.CodeDeliveryFailureException="CodeDeliveryFailureException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotFoundException="UserNotFoundException"})(ot||(ot={}));var st;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(st||(st={}));var it;(function(e){e.ExternalServiceException="ExternalServiceException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceConflictException="ResourceConflictException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException"})(it||(it={}));var at;(function(e){e.ExternalServiceException="ExternalServiceException",e.InternalErrorException="InternalErrorException",e.InvalidIdentityPoolConfigurationException="InvalidIdentityPoolConfigurationException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceConflictException="ResourceConflictException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException"})(at||(at={}));var rt;(function(e){e.CodeDeliveryFailureException="CodeDeliveryFailureException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(rt||(rt={}));var ct;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException"})(ct||(ct={}));var Ne;(function(e){e.PasswordResetRequiredException="PasswordResetRequiredException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(Ne||(Ne={}));var lt;(function(e){e.CodeDeliveryFailureException="CodeDeliveryFailureException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotFoundException="UserNotFoundException"})(lt||(lt={}));var dt;(function(e){e.AliasExistsException="AliasExistsException",e.CodeMismatchException="CodeMismatchException",e.ExpiredCodeException="ExpiredCodeException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidPasswordException="InvalidPasswordException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.MFAMethodNotFoundException="MFAMethodNotFoundException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.SoftwareTokenMFANotFoundException="SoftwareTokenMFANotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(dt||(dt={}));var ut;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(ut||(ut={}));var Et;(function(e){e.CodeDeliveryFailureException="CodeDeliveryFailureException",e.InternalErrorException="InternalErrorException",e.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidPasswordException="InvalidPasswordException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.NotAuthorizedException="NotAuthorizedException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UsernameExistsException="UsernameExistsException"})(Et||(Et={}));var pt;(function(e){e.AliasExistsException="AliasExistsException",e.CodeDeliveryFailureException="CodeDeliveryFailureException",e.CodeMismatchException="CodeMismatchException",e.ExpiredCodeException="ExpiredCodeException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",e.InvalidLambdaResponseException="InvalidLambdaResponseException",e.InvalidParameterException="InvalidParameterException",e.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",e.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UnexpectedLambdaException="UnexpectedLambdaException",e.UserLambdaValidationException="UserLambdaValidationException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(pt||(pt={}));var ht;(function(e){e.CodeMismatchException="CodeMismatchException",e.EnableSoftwareTokenMFAException="EnableSoftwareTokenMFAException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.SoftwareTokenMFANotFoundException="SoftwareTokenMFANotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(ht||(ht={}));var mt;(function(e){e.AliasExistsException="AliasExistsException",e.CodeMismatchException="CodeMismatchException",e.ExpiredCodeException="ExpiredCodeException",e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.LimitExceededException="LimitExceededException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(mt||(mt={}));var gt;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(gt||(gt={}));var St;(function(e){e.ForbiddenException="ForbiddenException",e.InternalErrorException="InternalErrorException",e.InvalidParameterException="InvalidParameterException",e.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",e.NotAuthorizedException="NotAuthorizedException",e.PasswordResetRequiredException="PasswordResetRequiredException",e.ResourceNotFoundException="ResourceNotFoundException",e.TooManyRequestsException="TooManyRequestsException",e.UserNotConfirmedException="UserNotConfirmedException",e.UserNotFoundException="UserNotFoundException"})(St||(St={}));const pn=async e=>{const t=e.getConfig().Auth?.Cognito;O(t);const n=await e.Auth.getTokens({forceRefresh:!1});Ht(n);const{"cognito:username":o,sub:i}=n.idToken?.payload??{},s={username:o,userId:i},a=hn(n);return a&&(s.signInDetails=a),s};function hn(e){return e?.signInDetails}const me=async()=>pn(D),x=(e,t)=>Wt({category:zt.Auth,action:e,...t}),Se=e=>te(ie,se("InitiateAuth"),oe(),{...ne,...e}),w=e=>te(ie,se("RespondToAuthChallenge"),oe(),{...ne,...e}),mn=e=>te(ie,se("VerifySoftwareToken"),oe(),{...ne,...e}),gn=e=>te(ie,se("AssociateSoftwareToken"),oe(),{...ne,...e});async function Y(e){if(e.AccessToken){const t=je(e.AccessToken),n=(t.payload.iat||0)*1e3,o=new Date().getTime(),i=n>0?n-o:0;let s,a,r;e.RefreshToken&&(a=e.RefreshToken),e.IdToken&&(s=je(e.IdToken)),e?.NewDeviceMetadata&&(r=e.NewDeviceMetadata);const c={accessToken:t,idToken:s,refreshToken:a,clockDrift:i,deviceMetadata:r,username:e.username};e?.signInDetails&&(c.signInDetails=e.signInDetails),await N.setTokens({tokens:c})}else throw new Nt({message:"Invalid tokens",name:"InvalidTokens",recoverySuggestion:"Check Cognito UserPool settings"})}const Sn="Unable to get user session following successful sign-in.",J=async()=>{try{be.dispatch("auth",{event:"signedIn",data:await me()},"Auth",Le)}catch(e){throw e.name===Kt?new P({name:$t,message:Sn,recoverySuggestion:"This most likely is due to auth tokens not being persisted. If you are using cookie store, please ensure cookies can be correctly set from your server."}):e}};function Ft(){return{active:!1}}const fn=(e,t)=>{switch(t.type){case"SET_USERNAME":return{...e,username:t.value};case"SET_SESSION":return{...e,session:t.value};case"START":return{...e,active:!0};case"RESET":return Ft();default:return e}},In=e=>{let t=e(Ft(),{type:"RESET"});return{getState:()=>t,dispatch:n=>{t=e(t,n)}}},Dt=In(fn),Rn=180*1e3,Re="CognitoSignInState",H={username:`${Re}.username`,challengeName:`${Re}.challengeName`,signInSession:`${Re}.signInSession`,expiry:`${Re}.expiry`},yn=(e,t)=>{switch(t.type){case"SET_SIGN_IN_SESSION":return ye({signInSession:t.value}),{...e,signInSession:t.value};case"SET_SIGN_IN_STATE":return ye(t.value),{...t.value};case"SET_CHALLENGE_NAME":return ye({challengeName:t.value}),{...e,challengeName:t.value};case"SET_USERNAME":return ye({username:t.value}),{...e,username:t.value};case"SET_INITIAL_STATE":return Cn();case"RESET_STATE":return Ut(),Be();default:return e}},An=e=>{const t=Number(e),n=Date.now();return t<=n},U=()=>{b.dispatch({type:"RESET_STATE"})},Ut=()=>{for(const e of Object.values(H))q.removeItem(e)},Be=()=>({username:void 0,challengeName:void 0,signInSession:void 0}),Cn=()=>{const e=q.getItem(H.expiry);if(!e||An(e))return Ut(),Be();const t=q.getItem(H.username)??void 0,n=q.getItem(H.challengeName)??void 0,o=q.getItem(H.signInSession)??void 0;return{username:t,challengeName:n,signInSession:o}},xn=e=>{let t=e(Be(),{type:"SET_INITIAL_STATE"});return{getState:()=>t,dispatch:n=>{t=e(t,n)}}},b=xn(yn);function G(e){b.dispatch({type:"SET_SIGN_IN_STATE",value:e})}const ye=({challengeName:e,signInSession:t,username:n})=>{n&&q.setItem(H.username,n),e&&q.setItem(H.challengeName,e),t&&(q.setItem(H.signInSession,t),q.setItem(H.expiry,String(Date.now()+Rn)))};class W extends Nt{constructor(t){super(t),this.constructor=W,Object.setPrototypeOf(this,W.prototype)}}var R;(function(e){e.PasskeyNotSupported="PasskeyNotSupported",e.PasskeyAlreadyExists="PasskeyAlreadyExists",e.InvalidPasskeyRegistrationOptions="InvalidPasskeyRegistrationOptions",e.InvalidPasskeyAuthenticationOptions="InvalidPasskeyAuthenticationOptions",e.RelyingPartyMismatch="RelyingPartyMismatch",e.PasskeyRegistrationFailed="PasskeyRegistrationFailed",e.PasskeyRetrievalFailed="PasskeyRetrievalFailed",e.PasskeyRegistrationCanceled="PasskeyRegistrationCanceled",e.PasskeyAuthenticationCanceled="PasskeyAuthenticationCanceled",e.PasskeyOperationAborted="PasskeyOperationAborted"})(R||(R={}));const ft="Passkeys may not be supported on this device. Ensure your application is running in a secure context (HTTPS) and Web Authentication API is supported.",Fe="User may have canceled the ceremony or another interruption has occurred. Check underlying error for details.",It="Ensure your user pool is configured to support the WEB_AUTHN as an authentication factor.",ve={[R.PasskeyNotSupported]:{message:"Passkeys may not be supported on this device.",recoverySuggestion:ft},[R.InvalidPasskeyRegistrationOptions]:{message:"Invalid passkey registration options.",recoverySuggestion:It},[R.InvalidPasskeyAuthenticationOptions]:{message:"Invalid passkey authentication options.",recoverySuggestion:It},[R.PasskeyRegistrationFailed]:{message:"Device failed to create passkey.",recoverySuggestion:ft},[R.PasskeyRetrievalFailed]:{message:"Device failed to retrieve passkey.",recoverySuggestion:"Passkeys may not be available on this device. Try an alternative authentication factor like PASSWORD, EMAIL_OTP, or SMS_OTP."},[R.PasskeyAlreadyExists]:{message:"Passkey already exists in authenticator.",recoverySuggestion:"Proceed with existing passkey or try again after deleting the credential."},[R.PasskeyRegistrationCanceled]:{message:"Passkey registration ceremony has been canceled.",recoverySuggestion:Fe},[R.PasskeyAuthenticationCanceled]:{message:"Passkey authentication ceremony has been canceled.",recoverySuggestion:Fe},[R.PasskeyOperationAborted]:{message:"Passkey operation has been aborted.",recoverySuggestion:Fe},[R.RelyingPartyMismatch]:{message:"Relying party does not match current domain.",recoverySuggestion:"Ensure relying party identifier matches current domain."}},qe=Vt(ve,W),Pn=e=>{if(e instanceof W)return e;if(e instanceof Error&&e.name==="NotAllowedError"){const{message:t,recoverySuggestion:n}=ve[R.PasskeyAuthenticationCanceled];return new W({name:R.PasskeyAuthenticationCanceled,message:t,recoverySuggestion:n,underlyingError:e})}return Tn(e)},Tn=e=>{if(e instanceof Error){if(e.name==="AbortError"){const{message:t,recoverySuggestion:n}=ve[R.PasskeyOperationAborted];return new W({name:R.PasskeyOperationAborted,message:t,recoverySuggestion:n,underlyingError:e})}if(e.name==="SecurityError"){const{message:t,recoverySuggestion:n}=ve[R.RelyingPartyMismatch];return new W({name:R.RelyingPartyMismatch,message:t,recoverySuggestion:n,underlyingError:e})}}return new W({name:jt.Unknown,message:"An unknown error has occurred.",underlyingError:e})},Nn=()=>Yt()&&window.isSecureContext&&"credentials"in navigator&&typeof window.PublicKeyCredential=="function",he=e=>ge.convert(new Uint8Array(e),{urlSafe:!0,skipPadding:!0}),Rt=e=>Uint8Array.from(vt.convert(e,{urlSafe:!0}),t=>t.charCodeAt(0)).buffer,vn=e=>{const t=Rt(e.challenge),n=(e.allowCredentials||[]).map(o=>({...o,id:Rt(o.id)}));return{...e,challenge:t,allowCredentials:n}},wn=e=>{const t={clientDataJSON:he(e.response.clientDataJSON),authenticatorData:he(e.response.authenticatorData),signature:he(e.response.signature)};e.response.userHandle&&(t.userHandle=he(e.response.userHandle));const n={id:e.id,rawId:he(e.rawId),type:e.type,clientExtensionResults:e.getClientExtensionResults(),response:t};return e.authenticatorAttachment&&(n.authenticatorAttachment=e.authenticatorAttachment),n};function _n(e){qe(e&&e instanceof PublicKeyCredential&&e.response instanceof AuthenticatorAssertionResponse,R.PasskeyRetrievalFailed)}const Mn=async e=>{try{const t=Nn();qe(t,R.PasskeyNotSupported);const n=vn(e),o=await navigator.credentials.get({publicKey:n});return _n(o),wn(o)}catch(t){throw Pn(t)}},Fn=e=>te(ie,se("ConfirmDevice"),oe(),{...ne,...e}),xe={convert(e){return new TextEncoder().encode(e)}};function E(e,t){e!=null&&this.fromString(e,t)}function T(){return new E(null,null)}let V;const Dn=0xdeadbeefcafe,yt=(Dn&16777215)===15715070;function Un(e,t,n,o,i,s){for(;--s>=0;){const a=t*this[e++]+n[o]+i;i=Math.floor(a/67108864),n[o++]=a&67108863}return i}function On(e,t,n,o,i,s){const a=t&32767,r=t>>15;for(;--s>=0;){let c=this[e]&32767;const l=this[e++]>>15,d=r*c+l*a;c=a*c+((d&32767)<<15)+n[o]+(i&1073741823),i=(c>>>30)+(d>>>15)+r*l+(i>>>30),n[o++]=c&1073741823}return i}function bn(e,t,n,o,i,s){const a=t&16383,r=t>>14;for(;--s>=0;){let c=this[e]&16383;const l=this[e++]>>14,d=r*c+l*a;c=a*c+((d&16383)<<14)+n[o]+i,i=(c>>28)+(d>>14)+r*l,n[o++]=c&268435455}return i}const At=typeof navigator<"u";At&&yt&&navigator.appName==="Microsoft Internet Explorer"?(E.prototype.am=On,V=30):At&&yt&&navigator.appName!=="Netscape"?(E.prototype.am=Un,V=26):(E.prototype.am=bn,V=28);E.prototype.DB=V;E.prototype.DM=(1<<V)-1;E.prototype.DV=1<<V;const He=52;E.prototype.FV=Math.pow(2,He);E.prototype.F1=He-V;E.prototype.F2=2*V-He;const Ln="0123456789abcdefghijklmnopqrstuvwxyz",we=[];let ce,F;ce=48;for(F=0;F<=9;++F)we[ce++]=F;ce=97;for(F=10;F<36;++F)we[ce++]=F;ce=65;for(F=10;F<36;++F)we[ce++]=F;function Ct(e){return Ln.charAt(e)}function kn(e,t){const n=we[e.charCodeAt(t)];return n??-1}function Bn(e){for(let t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s}function qn(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0}function We(e){const t=T();return t.fromInt(e),t}function Hn(e,t){let n;if(t===16)n=4;else if(t===8)n=3;else if(t===2)n=1;else if(t===32)n=5;else if(t===4)n=2;else throw new Error("Only radix 2, 4, 8, 16, 32 are supported");this.t=0,this.s=0;let o=e.length,i=!1,s=0;for(;--o>=0;){const a=kn(e,o);if(a<0){e.charAt(o)==="-"&&(i=!0);continue}i=!1,s===0?this[this.t++]=a:s+n>this.DB?(this[this.t-1]|=(a&(1<<this.DB-s)-1)<<s,this[this.t++]=a>>this.DB-s):this[this.t-1]|=a<<s,s+=n,s>=this.DB&&(s-=this.DB)}this.clamp(),i&&E.ZERO.subTo(this,this)}function Wn(){const e=this.s&this.DM;for(;this.t>0&&this[this.t-1]==e;)--this.t}function zn(e){if(this.s<0)return"-"+this.negate().toString(e);let t;if(e==16)t=4;else if(e===8)t=3;else if(e===2)t=1;else if(e===32)t=5;else if(e===4)t=2;else throw new Error("Only radix 2, 4, 8, 16, 32 are supported");const n=(1<<t)-1;let o,i=!1,s="",a=this.t,r=this.DB-a*this.DB%t;if(a-- >0)for(r<this.DB&&(o=this[a]>>r)>0&&(i=!0,s=Ct(o));a>=0;)r<t?(o=(this[a]&(1<<r)-1)<<t-r,o|=this[--a]>>(r+=this.DB-t)):(o=this[a]>>(r-=t)&n,r<=0&&(r+=this.DB,--a)),o>0&&(i=!0),i&&(s+=Ct(o));return i?s:"0"}function Kn(){const e=T();return E.ZERO.subTo(this,e),e}function $n(){return this.s<0?this.negate():this}function Vn(e){let t=this.s-e.s;if(t!=0)return t;let n=this.t;if(t=n-e.t,t!=0)return this.s<0?-t:t;for(;--n>=0;)if((t=this[n]-e[n])!=0)return t;return 0}function ze(e){let t=1,n;return(n=e>>>16)!==0&&(e=n,t+=16),(n=e>>8)!==0&&(e=n,t+=8),(n=e>>4)!==0&&(e=n,t+=4),(n=e>>2)!==0&&(e=n,t+=2),(n=e>>1)!==0&&(e=n,t+=1),t}function jn(){return this.t<=0?0:this.DB*(this.t-1)+ze(this[this.t-1]^this.s&this.DM)}function Yn(e,t){let n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s}function Jn(e,t){for(let n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s}function Gn(e,t){const n=e%this.DB,o=this.DB-n,i=(1<<o)-1,s=Math.floor(e/this.DB);let a=this.s<<n&this.DM,r;for(r=this.t-1;r>=0;--r)t[r+s+1]=this[r]>>o|a,a=(this[r]&i)<<n;for(r=s-1;r>=0;--r)t[r]=0;t[s]=a,t.t=this.t+s+1,t.s=this.s,t.clamp()}function Zn(e,t){t.s=this.s;const n=Math.floor(e/this.DB);if(n>=this.t){t.t=0;return}const o=e%this.DB,i=this.DB-o,s=(1<<o)-1;t[0]=this[n]>>o;for(let a=n+1;a<this.t;++a)t[a-n-1]|=(this[a]&s)<<i,t[a-n]=this[a]>>o;o>0&&(t[this.t-n-1]|=(this.s&s)<<i),t.t=this.t-n,t.clamp()}function Xn(e,t){let n=0,o=0;const i=Math.min(e.t,this.t);for(;n<i;)o+=this[n]-e[n],t[n++]=o&this.DM,o>>=this.DB;if(e.t<this.t){for(o-=e.s;n<this.t;)o+=this[n],t[n++]=o&this.DM,o>>=this.DB;o+=this.s}else{for(o+=this.s;n<e.t;)o-=e[n],t[n++]=o&this.DM,o>>=this.DB;o-=e.s}t.s=o<0?-1:0,o<-1?t[n++]=this.DV+o:o>0&&(t[n++]=o),t.t=n,t.clamp()}function Qn(e,t){const n=this.abs(),o=e.abs();let i=n.t;for(t.t=i+o.t;--i>=0;)t[i]=0;for(i=0;i<o.t;++i)t[i+n.t]=n.am(0,o[i],t,i,0,n.t);t.s=0,t.clamp(),this.s!==e.s&&E.ZERO.subTo(t,t)}function eo(e){const t=this.abs();let n=e.t=2*t.t;for(;--n>=0;)e[n]=0;for(n=0;n<t.t-1;++n){const o=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,o,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()}function to(e,t,n){const o=e.abs();if(o.t<=0)return;const i=this.abs();if(i.t<o.t){t?.fromInt(0),n!=null&&this.copyTo(n);return}n===null&&(n=T());const s=T(),a=this.s,r=e.s,c=this.DB-ze(o[o.t-1]);c>0?(o.lShiftTo(c,s),i.lShiftTo(c,n)):(o.copyTo(s),i.copyTo(n));const l=s.t,d=s[l-1];if(d===0)return;const u=d*(1<<this.F1)+(l>1?s[l-2]>>this.F2:0),p=this.FV/u,h=(1<<this.F1)/u,m=1<<this.F2;let S=n.t,A=S-l;const y=t===null?T():t;for(s.dlShiftTo(A,y),n.compareTo(y)>=0&&(n[n.t++]=1,n.subTo(y,n)),E.ONE.dlShiftTo(l,y),y.subTo(s,s);s.t<l;)s[s.t++]=0;for(;--A>=0;){let L=n[--S]===d?this.DM:Math.floor(n[S]*p+(n[S-1]+m)*h);if((n[S]+=s.am(0,L,n,A,0,l))<L)for(s.dlShiftTo(A,y),n.subTo(y,n);n[S]<--L;)n.subTo(y,n)}t!==null&&(n.drShiftTo(l,t),a!==r&&E.ZERO.subTo(t,t)),n.t=l,n.clamp(),c>0&&n.rShiftTo(c,n),a<0&&E.ZERO.subTo(n,n)}function no(e){const t=T();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(E.ZERO)>0&&e.subTo(t,t),t}function oo(){if(this.t<1)return 0;const e=this[0];if((e&1)===0)return 0;let t=e&3;return t=t*(2-(e&15)*t)&15,t=t*(2-(e&255)*t)&255,t=t*(2-((e&65535)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function so(e){return this.compareTo(e)===0}function io(e,t){let n=0,o=0;const i=Math.min(e.t,this.t);for(;n<i;)o+=this[n]+e[n],t[n++]=o&this.DM,o>>=this.DB;if(e.t<this.t){for(o+=e.s;n<this.t;)o+=this[n],t[n++]=o&this.DM,o>>=this.DB;o+=this.s}else{for(o+=this.s;n<e.t;)o+=e[n],t[n++]=o&this.DM,o>>=this.DB;o+=e.s}t.s=o<0?-1:0,o>0?t[n++]=o:o<-1&&(t[n++]=this.DV+o),t.t=n,t.clamp()}function ao(e){const t=T();return this.addTo(e,t),t}function ro(e){const t=T();return this.subTo(e,t),t}function co(e){const t=T();return this.multiplyTo(e,t),t}function lo(e){const t=T();return this.divRemTo(e,t,null),t}function le(e){this.m=e,this.mp=e.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function uo(e){const t=T();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(E.ZERO)>0&&this.m.subTo(t,t),t}function Eo(e){const t=T();return e.copyTo(t),this.reduce(t),t}function po(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(let t=0;t<this.m.t;++t){let n=e[t]&32767;const o=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(n=t+this.m.t,e[n]+=this.m.am(0,o,e,t,0,this.m.t);e[n]>=e.DV;)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function ho(e,t){e.squareTo(t),this.reduce(t)}function mo(e,t,n){e.multiplyTo(t,n),this.reduce(n)}le.prototype.convert=uo;le.prototype.revert=Eo;le.prototype.reduce=po;le.prototype.mulTo=mo;le.prototype.sqrTo=ho;function go(e,t,n){let o=e.bitLength(),i,s=We(1);const a=new le(t);if(o<=0)return s;o<18?i=1:o<48?i=3:o<144?i=4:o<768?i=5:i=6;const r=[];let c=3;const l=i-1,d=(1<<i)-1;if(r[1]=a.convert(this),i>1){const y=T();for(a.sqrTo(r[1],y);c<=d;)r[c]=T(),a.mulTo(y,r[c-2],r[c]),c+=2}let u=e.t-1,p,h=!0,m=T(),S;for(o=ze(e[u])-1;u>=0;){for(o>=l?p=e[u]>>o-l&d:(p=(e[u]&(1<<o+1)-1)<<l-o,u>0&&(p|=e[u-1]>>this.DB+o-l)),c=i;(p&1)===0;)p>>=1,--c;if((o-=c)<0&&(o+=this.DB,--u),h)r[p].copyTo(s),h=!1;else{for(;c>1;)a.sqrTo(s,m),a.sqrTo(m,s),c-=2;c>0?a.sqrTo(s,m):(S=s,s=m,m=S),a.mulTo(m,r[p],s)}for(;u>=0&&(e[u]&1<<o)===0;)a.sqrTo(s,m),S=s,s=m,m=S,--o<0&&(o=this.DB-1,--u)}const A=a.revert(s);return n(null,A),A}E.prototype.copyTo=Bn;E.prototype.fromInt=qn;E.prototype.fromString=Hn;E.prototype.clamp=Wn;E.prototype.dlShiftTo=Yn;E.prototype.drShiftTo=Jn;E.prototype.lShiftTo=Gn;E.prototype.rShiftTo=Zn;E.prototype.subTo=Xn;E.prototype.multiplyTo=Qn;E.prototype.squareTo=eo;E.prototype.divRemTo=to;E.prototype.invDigit=oo;E.prototype.addTo=io;E.prototype.toString=zn;E.prototype.negate=Kn;E.prototype.abs=$n;E.prototype.compareTo=Vn;E.prototype.bitLength=jn;E.prototype.mod=no;E.prototype.equals=so;E.prototype.add=ao;E.prototype.subtract=ro;E.prototype.multiply=co;E.prototype.divide=lo;E.prototype.modPow=go;E.ZERO=We(0);E.ONE=We(1);const So=async({a:e,g:t,k:n,x:o,B:i,N:s,U:a})=>new Promise((r,c)=>{t.modPow(o,s,(l,d)=>{if(l){c(l);return}i.subtract(n.multiply(d)).modPow(e.add(a.multiply(o)),s,(u,p)=>{if(u){c(u);return}r(p.mod(s))})})}),fo="FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A93AD2CAFFFFFFFFFFFFFFFF",Ot={},De={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();t.length===1&&(t=`0${t}`),Ot[e]=t,De[t]=e}const ee=e=>{if(e.length%2!==0)throw new Error("Hex encoded strings must have an even number length");const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2){const o=e.slice(n,n+2).toLowerCase();if(o in De)t[n/2]=De[o];else throw new Error(`Cannot decode unrecognized sequence ${o} as hexadecimal`)}return t},Ke=e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=Ot[e[n]];return t},Ue=e=>{const t=new Te;t.update(e);const n=t.digestSync(),o=Ke(n);return new Array(64-o.length).join("0")+o},Pe=e=>Ue(ee(e)),Io=/^[89a-f]/i,B=e=>{if(!(e instanceof E))throw new Error("Not a BigInteger");const t=e.compareTo(E.ZERO)<0;let n=e.abs().toString(16);if(n=n.length%2!==0?`0${n}`:n,n=Io.test(n)?`00${n}`:n,t){const o=n.split("").map(s=>{const a=~parseInt(s,16)&15;return"0123456789ABCDEF".charAt(a)}).join("");n=new E(o,16).add(E.ONE).toString(16),n.toUpperCase().startsWith("FF8")&&(n=n.substring(2))}return n},Ro=({A:e,B:t})=>{const n=new E(Pe(B(e)+B(t)),16);if(n.equals(E.ZERO))throw new Error("U cannot be zero.");return n},yo=(e,t,n)=>{const o=new Te(t);o.update(e);const i=o.digestSync(),s=new Te(i);return s.update(n),s.digestSync().slice(0,16)},$e=e=>{const t=new ke().random(e).toString();return ee(t)},Ao=()=>ge.convert($e(40));class Co{constructor({userPoolName:t,a:n,g:o,A:i,N:s}){this.encoder=xe,this.userPoolName=t,this.a=n,this.g=o,this.A=i,this.N=s,this.k=new E(Pe(`${B(s)}${B(o)}`),16)}getRandomPassword(){if(!this.randomPassword)throw new P({name:"EmptyBigIntegerRandomPassword",message:"random password is empty"});return this.randomPassword}getSaltToHashDevices(){if(!this.saltToHashDevices)throw new P({name:"EmptyBigIntegersaltToHashDevices",message:"saltToHashDevices is empty"});return this.saltToHashDevices}getVerifierDevices(){if(!this.verifierDevices)throw new P({name:"EmptyBigIntegerVerifierDevices",message:"verifyDevices is empty"});return this.verifierDevices}async generateHashDevice(t,n){this.randomPassword=Ao();const o=`${t}${n}:${this.randomPassword}`,i=Ue(o),s=Ke($e(16));return this.saltToHashDevices=B(new E(s,16)),new Promise((a,r)=>{this.g.modPow(new E(Pe(this.saltToHashDevices+i),16),this.N,(c,l)=>{if(c){r(c);return}this.verifierDevices=B(l),a()})})}async getPasswordAuthenticationKey({username:t,password:n,serverBValue:o,salt:i}){if(o.mod(this.N).equals(E.ZERO))throw new Error("B cannot be zero.");const s=Ro({A:this.A,B:o}),a=`${this.userPoolName}${t}:${n}`,r=Ue(a),c=new E(Pe(B(i)+r),16),l=await So({a:this.a,g:this.g,k:this.k,x:c,B:o,N:this.N,U:s}),d=this.encoder.convert("Caldera Derived Key"),u=this.encoder.convert(""),p=new Uint8Array(d.byteLength+u.byteLength);return p.set(d,0),p.set(u,d.byteLength),yo(ee(B(l)),ee(B(s)),p)}}const xo=async({a:e,g:t,N:n})=>new Promise((o,i)=>{t.modPow(e,n,(s,a)=>{if(s){i(s);return}if(a.mod(n).equals(E.ZERO)){i(new Error("Illegal parameter. A mod N cannot be 0."));return}o(a)})}),fe=async e=>{const t=new E(fo,16),n=new E("2",16),o=Po(),i=await xo({a:o,g:n,N:t});return new Co({userPoolName:e,a:o,g:n,A:i,N:t})},Po=()=>{const e=Ke($e(128));return new E(e,16)};async function Z({userPoolId:e,userPoolEndpoint:t,newDeviceMetadata:n,accessToken:o}){if(!n)return;const i=e.split("_")[1]||"",s=await fe(i),a=n?.DeviceKey,r=n?.DeviceGroupKey;try{await s.generateHashDevice(r??"",a??"")}catch{return}const c={Salt:ge.convert(ee(s.getSaltToHashDevices())),PasswordVerifier:ge.convert(ee(s.getVerifierDevices()))},l=s.getRandomPassword();try{return await Fn({endpointResolver:f({endpointOverride:t})})({region:I(e)},{AccessToken:o,DeviceName:await cn(),DeviceKey:n?.DeviceKey,DeviceSecretVerifierConfig:c}),{deviceKey:a,deviceGroupKey:r,randomPassword:l}}catch{return}}async function To(e){const t=D.getConfig().Auth?.Cognito;O(t);const{username:n,signInSession:o,signInDetails:i,challengeName:s}=b.getState();if(s!=="WEB_AUTHN"||!n)throw new P({name:z.SignInException,message:"Unable to proceed due to invalid sign in state."});const{CREDENTIAL_REQUEST_OPTIONS:a}=e;qe(!!a,R.InvalidPasskeyAuthenticationOptions);const r=await Mn(JSON.parse(a)),c=w({endpointResolver:f({endpointOverride:t.userPoolEndpoint})}),{ChallengeName:l,ChallengeParameters:d,AuthenticationResult:u,Session:p}=await c({region:I(t.userPoolId),userAgentValue:x(C.ConfirmSignIn)},{ChallengeName:"WEB_AUTHN",ChallengeResponses:{USERNAME:n,CREDENTIAL:JSON.stringify(r)},ClientId:t.userPoolClientId,Session:o});if(G({signInSession:p,username:n,challengeName:l,signInDetails:i}),u)return await Y({...u,username:n,NewDeviceMetadata:await Z({userPoolId:t.userPoolId,userPoolEndpoint:t.userPoolEndpoint,newDeviceMetadata:u.NewDeviceMetadata,accessToken:u.AccessToken}),signInDetails:i}),b.dispatch({type:"RESET_STATE"}),await J(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}};if(l==="WEB_AUTHN")throw new P({name:z.SignInException,message:"Sequential WEB_AUTHN challenges returned from underlying service cannot be handled."});return{challengeName:l,challengeParameters:d}}function _({username:e,userPoolId:t,userPoolClientId:n}){if(typeof window>"u")return;const o=window.AmazonCognitoAdvancedSecurityData;if(typeof o>"u")return;const i=o.getData(e,t,n);return i?{EncodedData:i}:{}}const No=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],vo=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],bt=()=>{const e=new Date,t=vo[e.getUTCDay()],n=No[e.getUTCMonth()],o=e.getUTCDate();let i=e.getUTCHours();i<10&&(i=`0${i}`);let s=e.getUTCMinutes();s<10&&(s=`0${s}`);let a=e.getUTCSeconds();a<10&&(a=`0${a}`);const r=e.getUTCFullYear();return`${t} ${n} ${o} ${i}:${s}:${a} UTC ${r}`},Lt=({userPoolName:e,username:t,challengeParameters:n,dateNow:o,hkdf:i})=>{const s=xe.convert(e),a=xe.convert(t),r=wo(n.SECRET_BLOCK),c=xe.convert(o),l=new Uint8Array(s.byteLength+a.byteLength+r.byteLength+c.byteLength);l.set(s,0),l.set(a,s.byteLength),l.set(r,s.byteLength+a.byteLength),l.set(c,s.byteLength+a.byteLength+r.byteLength);const d=new Te(i);d.update(l);const u=d.digestSync();return ge.convert(u)},wo=e=>{const t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/-/g,"+").replace(/_/g,"/"),o=vt.convert(n),i=new Uint8Array(o.length);for(let s=0;s<o.length;++s)i[s]=o.charCodeAt(s);return i};async function _e({username:e,config:t,clientMetadata:n,session:o,tokenOrchestrator:i}){const{userPoolId:s,userPoolEndpoint:a}=t,r=t.userPoolClientId,c=await i?.getDeviceMetadata(e);wt(c);const l=await fe(c.deviceGroupKey),d={USERNAME:e,SRP_A:l.A.toString(16),DEVICE_KEY:c.deviceKey},u={ChallengeName:"DEVICE_SRP_AUTH",ClientId:r,ChallengeResponses:d,ClientMetadata:n,Session:o},p=w({endpointResolver:f({endpointOverride:a})}),{ChallengeParameters:h,Session:m}=await p({region:I(s)},u);return _o(e,h,n,m,l,t,i)}async function _o(e,t,n,o,i,{userPoolId:s,userPoolClientId:a,userPoolEndpoint:r},c){const l=await c?.getDeviceMetadata(e);wt(l);const d=new E(t?.SRP_B,16),u=new E(t?.SALT,16),{deviceKey:p}=l,{deviceGroupKey:h}=l,m=await i.getPasswordAuthenticationKey({username:l.deviceKey,password:l.randomPassword,serverBValue:d,salt:u}),S=bt(),A={USERNAME:t?.USERNAME??e,PASSWORD_CLAIM_SECRET_BLOCK:t?.SECRET_BLOCK,TIMESTAMP:S,PASSWORD_CLAIM_SIGNATURE:Lt({username:p,userPoolName:h,challengeParameters:t,dateNow:S,hkdf:m}),DEVICE_KEY:p},y=_({username:e,userPoolId:s,userPoolClientId:a}),L={ChallengeName:"DEVICE_PASSWORD_VERIFIER",ClientId:a,ChallengeResponses:A,Session:o,ClientMetadata:n,UserContextData:y};return w({endpointResolver:f({endpointOverride:r})})({region:I(s)},L)}async function Ve(e,t,n,o,i,s,a){const{userPoolId:r,userPoolClientId:c,userPoolEndpoint:l}=s,d=r?.split("_")[1]||"",u=new E(t?.SRP_B,16),p=new E(t?.SALT,16),h=t?.USER_ID_FOR_SRP;if(!h)throw new P({name:"EmptyUserIdForSRPException",message:"USER_ID_FOR_SRP was not found in challengeParameters"});const m=await i.getPasswordAuthenticationKey({username:h,password:e,serverBValue:u,salt:p}),S=bt(),A={USERNAME:h,PASSWORD_CLAIM_SECRET_BLOCK:t?.SECRET_BLOCK,TIMESTAMP:S,PASSWORD_CLAIM_SIGNATURE:Lt({username:h,userPoolName:d,challengeParameters:t,dateNow:S,hkdf:m})},y=await a.getDeviceMetadata(h);y&&y.deviceKey&&(A.DEVICE_KEY=y.deviceKey);const L=_({username:h,userPoolId:r,userPoolClientId:c}),Ee={ChallengeName:"PASSWORD_VERIFIER",ChallengeResponses:A,ClientMetadata:n,Session:o,ClientId:c,UserContextData:L},Me=await w({endpointResolver:f({endpointOverride:l})})({region:I(r)},Ee);return Me.ChallengeName==="DEVICE_SRP_AUTH"?_e({username:h,config:s,clientMetadata:n,session:Me.Session,tokenOrchestrator:a}):Me}async function de(e,t,n,o){try{return await e(...t)}catch(i){if(i instanceof P&&i.name==="ResourceNotFoundException"&&i.message.includes("Device does not exist."))return await o.clearDeviceMetadata(n),e(...t);throw i}}function X(e){const{dispatch:t}=b;t({type:"SET_USERNAME",value:e})}async function kt({username:e,password:t,clientMetadata:n,config:o,tokenOrchestrator:i,authFlow:s,preferredChallenge:a}){const{userPoolId:r,userPoolClientId:c,userPoolEndpoint:l}=o,d=r?.split("_")[1]||"",u=await fe(d),p={USERNAME:e,SRP_A:u.A.toString(16)};s==="USER_AUTH"&&a&&(p.PREFERRED_CHALLENGE=a);const h=_({username:e,userPoolId:r,userPoolClientId:c}),m={AuthFlow:s,AuthParameters:p,ClientMetadata:n,ClientId:c,UserContextData:h},A=await Se({endpointResolver:f({endpointOverride:l})})({region:I(r),userAgentValue:x(C.SignIn)},m),{ChallengeParameters:y,Session:L}=A,Ee=y?.USERNAME??e;return X(Ee),A.ChallengeName==="PASSWORD_VERIFIER"?de(Ve,[t,y,n,L,u,o,i],Ee,i):A}async function Mo({username:e,session:t,selectedChallenge:n,config:o,clientMetadata:i}){return w({endpointResolver:f({endpointOverride:o.userPoolEndpoint})})({region:I(o.userPoolId),userAgentValue:x(C.ConfirmSignIn)},{ChallengeName:"SELECT_CHALLENGE",ChallengeResponses:{USERNAME:e,ANSWER:n},ClientId:o.userPoolClientId,Session:t,ClientMetadata:i})}async function Fo(e,t,n,o,i){const{userPoolId:s,userPoolClientId:a,userPoolEndpoint:r}=o,c={ANSWER:"PASSWORD",USERNAME:e,PASSWORD:t},l=_({username:e,userPoolId:s,userPoolClientId:a}),u=await w({endpointResolver:f({endpointOverride:r})})({region:I(s),userAgentValue:x(C.ConfirmSignIn)},{ChallengeName:"SELECT_CHALLENGE",ChallengeResponses:c,ClientId:a,ClientMetadata:n,Session:i,UserContextData:l}),p=u.ChallengeParameters?.USERNAME??e;return X(p),u}async function Do(e,t,n,o,i,s){const{userPoolId:a,userPoolClientId:r,userPoolEndpoint:c}=o,l=a.split("_")[1]||"",d=await fe(l),u={ANSWER:"PASSWORD_SRP",USERNAME:e,SRP_A:d.A.toString(16)},p=_({username:e,userPoolId:a,userPoolClientId:r}),m=await w({endpointResolver:f({endpointOverride:c})})({region:I(a),userAgentValue:x(C.ConfirmSignIn)},{ChallengeName:"SELECT_CHALLENGE",ChallengeResponses:u,ClientId:r,ClientMetadata:n,Session:i,UserContextData:p}),S=m.ChallengeParameters?.USERNAME??e;return X(S),m.ChallengeName==="PASSWORD_VERIFIER"?de(Ve,[t,m.ChallengeParameters,n,m.Session,d,o,s],S,s):m}const Oe="userAttributes.";function Uo(e){return"isSignedIn"in e&&"nextStep"in e}async function Oo({challengeResponse:e,clientMetadata:t,session:n,username:o,config:i,tokenOrchestrator:s}){const{userPoolId:a,userPoolClientId:r,userPoolEndpoint:c}=i,l={USERNAME:o,ANSWER:e},d=await s?.getDeviceMetadata(o);d&&d.deviceKey&&(l.DEVICE_KEY=d.deviceKey);const u=_({username:o,userPoolId:a,userPoolClientId:r}),p={ChallengeName:"CUSTOM_CHALLENGE",ChallengeResponses:l,Session:n,ClientMetadata:t,ClientId:r,UserContextData:u},m=await w({endpointResolver:f({endpointOverride:c})})({region:I(a),userAgentValue:x(C.ConfirmSignIn)},p);return m.ChallengeName==="DEVICE_SRP_AUTH"?_e({username:o,config:i,clientMetadata:t,session:m.Session,tokenOrchestrator:s}):m}async function bo({challengeResponse:e,username:t,clientMetadata:n,session:o,deviceName:i,config:s}){const{userPoolId:a,userPoolClientId:r,userPoolEndpoint:c}=s;if(e==="EMAIL")return{ChallengeName:"MFA_SETUP",Session:o,ChallengeParameters:{MFAS_CAN_SETUP:'["EMAIL_OTP"]'},$metadata:{}};if(e==="TOTP")return{ChallengeName:"MFA_SETUP",Session:o,ChallengeParameters:{MFAS_CAN_SETUP:'["SOFTWARE_TOKEN_MFA"]'},$metadata:{}};const l={USERNAME:t};if(/^\d+$/.test(e)){const p=mn({endpointResolver:f({endpointOverride:c})}),{Session:h}=await p({region:I(a),userAgentValue:x(C.ConfirmSignIn)},{UserCode:e,Session:o,FriendlyDeviceName:i});b.dispatch({type:"SET_SIGN_IN_SESSION",value:h});const m={ChallengeName:"MFA_SETUP",ChallengeResponses:l,Session:h,ClientMetadata:n,ClientId:r};return w({endpointResolver:f({endpointOverride:c})})({region:I(a),userAgentValue:x(C.ConfirmSignIn)},m)}if(e.includes("@")){l.EMAIL=e;const p={ChallengeName:"MFA_SETUP",ChallengeResponses:l,Session:o,ClientMetadata:n,ClientId:r};return w({endpointResolver:f({endpointOverride:c})})({region:I(a),userAgentValue:x(C.ConfirmSignIn)},p)}throw new P({name:z.SignInException,message:`Cannot proceed with MFA setup using challengeResponse: ${e}`,recoverySuggestion:'Try passing "EMAIL", "TOTP", a valid email, or OTP code as the challengeResponse.'})}async function Lo({challengeResponse:e,username:t,clientMetadata:n,session:o,config:i}){const{userPoolId:s,userPoolClientId:a,userPoolEndpoint:r}=i;v(e==="TOTP"||e==="SMS"||e==="EMAIL",g.IncorrectMFAMethod);const c={USERNAME:t,ANSWER:jo(e)},l=_({username:t,userPoolId:s,userPoolClientId:a}),d={ChallengeName:"SELECT_MFA_TYPE",ChallengeResponses:c,Session:o,ClientMetadata:n,ClientId:a,UserContextData:l};return w({endpointResolver:f({endpointOverride:r})})({region:I(s),userAgentValue:x(C.ConfirmSignIn)},d)}async function ko({challengeResponse:e,clientMetadata:t,session:n,username:o,requiredAttributes:i,config:s}){const{userPoolId:a,userPoolClientId:r,userPoolEndpoint:c}=s,l={...$o(i),NEW_PASSWORD:e,USERNAME:o},d=_({username:o,userPoolId:a,userPoolClientId:r}),u={ChallengeName:"NEW_PASSWORD_REQUIRED",ChallengeResponses:l,ClientMetadata:t,Session:n,ClientId:r,UserContextData:d};return w({endpointResolver:f({endpointOverride:c})})({region:I(a),userAgentValue:x(C.ConfirmSignIn)},u)}async function Bo(e,t,n,o,i){const{userPoolClientId:s,userPoolId:a,userPoolEndpoint:r}=o,c={USERNAME:e,PASSWORD:t},l=await i.getDeviceMetadata(e);l&&l.deviceKey&&(c.DEVICE_KEY=l.deviceKey);const d=_({username:e,userPoolId:a,userPoolClientId:s}),u={AuthFlow:"USER_PASSWORD_AUTH",AuthParameters:c,ClientMetadata:n,ClientId:s,UserContextData:d},h=await Se({endpointResolver:f({endpointOverride:r})})({region:I(a),userAgentValue:x(C.SignIn)},u),m=h.ChallengeParameters?.USERNAME??h.ChallengeParameters?.USER_ID_FOR_SRP??e;return X(m),h.ChallengeName==="DEVICE_SRP_AUTH"?_e({username:m,config:o,clientMetadata:n,session:h.Session,tokenOrchestrator:i}):h}async function qo(e,t,n,o,i){return kt({username:e,password:t,clientMetadata:n,config:o,tokenOrchestrator:i,authFlow:"USER_SRP_AUTH"})}async function Ho(e,t,n,o){const{userPoolClientId:i,userPoolId:s,userPoolEndpoint:a}=n,r={USERNAME:e},c=await o.getDeviceMetadata(e);c&&c.deviceKey&&(r.DEVICE_KEY=c.deviceKey);const l=_({username:e,userPoolId:s,userPoolClientId:i}),d={AuthFlow:"CUSTOM_AUTH",AuthParameters:r,ClientMetadata:t,ClientId:i,UserContextData:l},p=await Se({endpointResolver:f({endpointOverride:a})})({region:I(s),userAgentValue:x(C.SignIn)},d),h=p.ChallengeParameters?.USERNAME??e;return X(h),p.ChallengeName==="DEVICE_SRP_AUTH"?_e({username:h,config:n,clientMetadata:t,session:p.Session,tokenOrchestrator:o}):p}async function Wo(e,t,n,o,i){O(o);const{userPoolId:s,userPoolClientId:a,userPoolEndpoint:r}=o,c=s?.split("_")[1]||"",l=await fe(c),d={USERNAME:e,SRP_A:l.A.toString(16),CHALLENGE_NAME:"SRP_A"},u=_({username:e,userPoolId:s,userPoolClientId:a}),p={AuthFlow:"CUSTOM_AUTH",AuthParameters:d,ClientMetadata:n,ClientId:a,UserContextData:u},h=Se({endpointResolver:f({endpointOverride:r})}),{ChallengeParameters:m,Session:S}=await h({region:I(s),userAgentValue:x(C.SignIn)},p),A=m?.USERNAME??e;return X(A),de(Ve,[t,m,n,S,l,o,i],A,i)}async function Q(e){const{challengeName:t,challengeParameters:n,availableChallenges:o}=e,i=D.getConfig().Auth?.Cognito;switch(O(i),t){case"CUSTOM_CHALLENGE":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_CUSTOM_CHALLENGE",additionalInfo:n}};case"MFA_SETUP":{const{signInSession:s,username:a}=b.getState(),r=xt(Pt(n.MFAS_CAN_SETUP))||[],c=Jo(r),l=c.includes("TOTP"),d=c.includes("EMAIL");if(l&&d)return{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_MFA_SETUP_SELECTION",allowedMFATypes:c}};if(d)return{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_EMAIL_SETUP"}};if(l){const u=gn({endpointResolver:f({endpointOverride:i.userPoolEndpoint})}),{Session:p,SecretCode:h}=await u({region:I(i.userPoolId)},{Session:s});return b.dispatch({type:"SET_SIGN_IN_SESSION",value:p}),{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_TOTP_SETUP",totpSetupDetails:zo(h,a)}}}throw new P({name:z.SignInException,message:`Cannot initiate MFA setup from available types: ${r}`})}case"NEW_PASSWORD_REQUIRED":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_NEW_PASSWORD_REQUIRED",missingAttributes:Ko(n.requiredAttributes)}};case"SELECT_MFA_TYPE":return{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_MFA_SELECTION",allowedMFATypes:xt(Pt(n.MFAS_CAN_CHOOSE))}};case"SMS_OTP":case"SMS_MFA":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_SMS_CODE",codeDeliveryDetails:{deliveryMedium:n.CODE_DELIVERY_DELIVERY_MEDIUM,destination:n.CODE_DELIVERY_DESTINATION}}};case"SOFTWARE_TOKEN_MFA":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_TOTP_CODE"}};case"EMAIL_OTP":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_EMAIL_CODE",codeDeliveryDetails:{deliveryMedium:n.CODE_DELIVERY_DELIVERY_MEDIUM,destination:n.CODE_DELIVERY_DESTINATION}}};case"WEB_AUTHN":{const s=await To(n);return Uo(s)?s:Q(s)}case"PASSWORD":case"PASSWORD_SRP":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_PASSWORD"}};case"SELECT_CHALLENGE":return{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_FIRST_FACTOR_SELECTION",availableChallenges:o}}}throw new P({name:z.SignInException,message:`An error occurred during the sign in process. ${t} challengeName returned by the underlying service was not addressed.`})}function zo(e,t){return{sharedSecret:e,getSetupUri:(n,o)=>{const i=`otpauth://totp/${n}:${o??t}?secret=${e}&issuer=${n}`;return new Gt(i)}}}function ue(e){if(e===Ne.PasswordResetRequiredException)return{isSignedIn:!1,nextStep:{signInStep:"RESET_PASSWORD"}};if(e===Ne.UserNotConfirmedException)return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_UP"}}}function Ko(e){return e?JSON.parse(e).map(n=>n.includes(Oe)?n.replace(Oe,""):n):[]}function $o(e){if(!e)return{};const t={};return Object.entries(e).forEach(([n,o])=>{o&&(t[`${Oe}${n}`]=o)}),t}async function Vo(e,t,n,o,i,s,a,r){const c=r?.userAttributes,l=r?.friendlyDeviceName;switch(t){case"WEB_AUTHN":case"SELECT_CHALLENGE":return o==="PASSWORD_SRP"||o==="PASSWORD"?{ChallengeName:o,Session:n,$metadata:{}}:Mo({username:e,session:n,selectedChallenge:o,config:i,clientMetadata:a});case"SELECT_MFA_TYPE":return Lo({challengeResponse:o,clientMetadata:a,session:n,username:e,config:i});case"MFA_SETUP":return bo({challengeResponse:o,clientMetadata:a,session:n,username:e,deviceName:l,config:i});case"NEW_PASSWORD_REQUIRED":return ko({challengeResponse:o,clientMetadata:a,session:n,username:e,requiredAttributes:c,config:i});case"CUSTOM_CHALLENGE":return de(Oo,[{challengeResponse:o,clientMetadata:a,session:n,username:e,config:i,tokenOrchestrator:s}],e,s);case"SMS_MFA":case"SOFTWARE_TOKEN_MFA":case"SMS_OTP":case"EMAIL_OTP":return Zo({challengeName:t,challengeResponse:o,clientMetadata:a,session:n,username:e,config:i});case"PASSWORD":return Fo(e,o,a,i,n);case"PASSWORD_SRP":return Do(e,o,a,i,n,s)}throw new P({name:z.SignInException,message:`An error occurred during the sign in process.
		${t} challengeName returned by the underlying service was not addressed.`})}function jo(e){let t="SMS_MFA";return e==="TOTP"&&(t="SOFTWARE_TOKEN_MFA"),e==="EMAIL"&&(t="EMAIL_OTP"),t}function Yo(e){if(e==="SMS_MFA")return"SMS";if(e==="SOFTWARE_TOKEN_MFA")return"TOTP";if(e==="EMAIL_OTP")return"EMAIL"}function xt(e){if(e)return e.map(Yo).filter(Boolean)}function Pt(e){return e?JSON.parse(e):[]}function Jo(e){return e.filter(t=>t==="EMAIL"||t==="TOTP")}async function Go(){let e;try{e=await me()}catch{}if(e&&e.userId&&e.username)throw new P({name:Jt,message:"There is already a signed in user.",recoverySuggestion:"Call signOut before calling signIn again."})}function Ie(e){return b.getState().username??e}async function Zo({challengeName:e,challengeResponse:t,clientMetadata:n,session:o,username:i,config:s}){const{userPoolId:a,userPoolClientId:r,userPoolEndpoint:c}=s,l={USERNAME:i};e==="EMAIL_OTP"&&(l.EMAIL_OTP_CODE=t),e==="SMS_MFA"&&(l.SMS_MFA_CODE=t),e==="SMS_OTP"&&(l.SMS_OTP_CODE=t),e==="SOFTWARE_TOKEN_MFA"&&(l.SOFTWARE_TOKEN_MFA_CODE=t);const d=_({username:i,userPoolId:a,userPoolClientId:r}),u={ChallengeName:e,ChallengeResponses:l,Session:o,ClientMetadata:n,ClientId:r,UserContextData:d};return w({endpointResolver:f({endpointOverride:c})})({region:I(a),userAgentValue:x(C.ConfirmSignIn)},u)}async function Xo(e){const t=D.getConfig().Auth?.Cognito;O(t);const{username:n,password:o,options:i}=e,s={loginId:n,authFlowType:"CUSTOM_WITHOUT_SRP"},a=i?.clientMetadata;v(!!n,g.EmptySignInUsername),v(!o,g.CustomAuthSignInPassword);try{const{ChallengeName:r,ChallengeParameters:c,AuthenticationResult:l,Session:d}=await de(Ho,[n,a,t,N],n,N),u=Ie(n);return G({signInSession:d,username:u,challengeName:r,signInDetails:s}),l?(await Y({username:u,...l,NewDeviceMetadata:await Z({userPoolId:t.userPoolId,userPoolEndpoint:t.userPoolEndpoint,newDeviceMetadata:l.NewDeviceMetadata,accessToken:l.AccessToken}),signInDetails:s}),U(),await J(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Q({challengeName:r,challengeParameters:c})}catch(r){U(),ae(r);const c=ue(r.name);if(c)return c;throw r}}async function Qo(e){const{username:t,password:n,options:o}=e,i={loginId:t,authFlowType:"CUSTOM_WITH_SRP"},s=D.getConfig().Auth?.Cognito;O(s);const a=o?.clientMetadata;v(!!t,g.EmptySignInUsername),v(!!n,g.EmptySignInPassword);try{const{ChallengeName:r,ChallengeParameters:c,AuthenticationResult:l,Session:d}=await Wo(t,n,a,s,N),u=Ie(t);return G({signInSession:d,username:u,challengeName:r,signInDetails:i}),l?(await Y({username:u,...l,NewDeviceMetadata:await Z({userPoolId:s.userPoolId,userPoolEndpoint:s.userPoolEndpoint,newDeviceMetadata:l.NewDeviceMetadata,accessToken:l.AccessToken}),signInDetails:i}),U(),await J(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Q({challengeName:r,challengeParameters:c})}catch(r){U(),ae(r);const c=ue(r.name);if(c)return c;throw r}}function j(e=!0){Dt.dispatch({type:"RESET"})}async function Tt(e){const{username:t,password:n}=e,o=D.getConfig().Auth?.Cognito,i={loginId:t,authFlowType:"USER_SRP_AUTH"};O(o);const s=e.options?.clientMetadata;v(!!t,g.EmptySignInUsername),v(!!n,g.EmptySignInPassword);try{const{ChallengeName:a,ChallengeParameters:r,AuthenticationResult:c,Session:l}=await qo(t,n,s,o,N),d=Ie(t);return G({signInSession:l,username:d,challengeName:a,signInDetails:i}),c?(await Y({username:d,...c,NewDeviceMetadata:await Z({userPoolId:o.userPoolId,userPoolEndpoint:o.userPoolEndpoint,newDeviceMetadata:c.NewDeviceMetadata,accessToken:c.AccessToken}),signInDetails:i}),U(),await J(),j(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Q({challengeName:a,challengeParameters:r})}catch(a){U(),j(),ae(a);const r=ue(a.name);if(r)return r;throw a}}async function es(e){const{username:t,password:n,options:o}=e,i=D.getConfig().Auth?.Cognito,s={loginId:t,authFlowType:"USER_PASSWORD_AUTH"};O(i);const a=o?.clientMetadata;v(!!t,g.EmptySignInUsername),v(!!n,g.EmptySignInPassword);try{const{ChallengeName:r,ChallengeParameters:c,AuthenticationResult:l,Session:d}=await de(Bo,[t,n,a,i,N],t,N),u=Ie(t);return G({signInSession:d,username:u,challengeName:r,signInDetails:s}),l?(await Y({...l,username:u,NewDeviceMetadata:await Z({userPoolId:i.userPoolId,userPoolEndpoint:i.userPoolEndpoint,newDeviceMetadata:l.NewDeviceMetadata,accessToken:l.AccessToken}),signInDetails:s}),U(),await J(),j(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Q({challengeName:r,challengeParameters:c})}catch(r){U(),j(),ae(r);const c=ue(r.name);if(c)return c;throw r}}async function ts({username:e,clientMetadata:t,config:n,tokenOrchestrator:o,preferredChallenge:i,password:s,session:a}){const{userPoolId:r,userPoolClientId:c,userPoolEndpoint:l}=n,d=_({username:e,userPoolId:r,userPoolClientId:c}),u={USERNAME:e};if(i){if(i==="PASSWORD_SRP")return v(!!s,g.EmptySignInPassword),kt({username:e,password:s,clientMetadata:t,config:n,tokenOrchestrator:o,authFlow:"USER_AUTH",preferredChallenge:i});i==="PASSWORD"&&(v(!!s,g.EmptySignInPassword),u.PASSWORD=s),u.PREFERRED_CHALLENGE=i}const p={AuthFlow:"USER_AUTH",AuthParameters:u,ClientMetadata:t,ClientId:c,UserContextData:d};a&&(p.Session=a);const m=await Se({endpointResolver:f({endpointOverride:l})})({region:I(r),userAgentValue:x(C.SignIn)},p);return X(e),m}async function ns(e){const{username:t,password:n,options:o}=e,i=D.getConfig().Auth?.Cognito,s={loginId:t,authFlowType:"USER_AUTH"};O(i);const a=o?.clientMetadata,r=o?.preferredChallenge;v(!!t,g.EmptySignInUsername);try{const c={username:t,config:i,tokenOrchestrator:N,clientMetadata:a,preferredChallenge:r,password:n},l=Dt.getState();l.active&&l.username===t&&(c.session=l.session);const d=await ts(c),u=Ie(t);return G({signInSession:d.Session,username:u,challengeName:d.ChallengeName,signInDetails:s}),d.AuthenticationResult?(await Y({username:u,...d.AuthenticationResult,NewDeviceMetadata:await Z({userPoolId:i.userPoolId,userPoolEndpoint:i.userPoolEndpoint,newDeviceMetadata:d.AuthenticationResult.NewDeviceMetadata,accessToken:d.AuthenticationResult.AccessToken}),signInDetails:s}),U(),await J(),j(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Q({challengeName:d.ChallengeName,challengeParameters:d.ChallengeParameters,availableChallenges:"AvailableChallenges"in d?d.AvailableChallenges:void 0})}catch(c){U(),j(),ae(c);const l=ue(c.name);if(l)return l;throw c}}async function os(e){j(!1);const t=e.options?.authFlowType;switch(await Go(),t){case"USER_SRP_AUTH":return Tt(e);case"USER_PASSWORD_AUTH":return es(e);case"CUSTOM_WITHOUT_SRP":return Xo(e);case"CUSTOM_WITH_SRP":return Qo(e);case"USER_AUTH":return ns(e);default:return Tt(e)}}async function ss(e){const{challengeResponse:t,options:n}=e,{username:o,challengeName:i,signInSession:s,signInDetails:a}=b.getState(),r=D.getConfig().Auth?.Cognito;O(r);const c=n?.clientMetadata;if(v(!!t,g.EmptyChallengeResponse),!o||!i||!s)throw new P({name:z.SignInException,message:`
			An error occurred during the sign in process.

			This most likely occurred due to:
			1. signIn was not called before confirmSignIn.
			2. signIn threw an exception.
			3. page was refreshed during the sign in flow and session has expired.
			`,recoverySuggestion:"Make sure a successful call to signIn is made before calling confirmSignInand that the session has not expired."});try{const{Session:l,ChallengeName:d,AuthenticationResult:u,ChallengeParameters:p}=await Vo(o,i,s,t,r,N,c,n);return G({signInSession:l,username:o,challengeName:d,signInDetails:a}),u?(await Y({username:o,...u,NewDeviceMetadata:await Z({userPoolId:r.userPoolId,userPoolEndpoint:r.userPoolEndpoint,newDeviceMetadata:u.NewDeviceMetadata,accessToken:u.AccessToken}),signInDetails:a}),U(),await J(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Q({challengeName:d,challengeParameters:p})}catch(l){ae(l);const d=ue(l.name);if(d)return d;throw l}}function is(e,t){{const n=e?.find(as)??e?.find(rs),o=e?.find(ls)??e?.find(cs);if(n)return n;throw o?Zt:Xt}}const as=e=>e.startsWith(String(window.location.origin+(window.location.pathname||"/"))),rs=e=>e.includes(String(window.location.hostname)),cs=e=>e.startsWith("http://"),ls=e=>e.startsWith("https://"),ds=async e=>{window?.location&&(window.location.href=e.replace("http://","https://"))},us=async e=>{await e.clearOAuthData(),N.clearTokens(),await Mt(),be.dispatch("auth",{event:"signedOut"},"Auth",Le)},Es=async(e,t=!1,n)=>{_t(e);const{loginWith:o,userPoolClientId:i}=e,{domain:s,redirectSignOut:a}=o.oauth,r=is(a),c=`https://${s}/logout?${Object.entries({client_id:i,logout_uri:encodeURIComponent(r)}).map(([l,d])=>`${l}=${d}`).join("&")}`;return ds(c)},ps=async(e,t,n,o)=>{const{isOAuthSignIn:i}=await t.loadOAuthSignIn(),s=await n.getOAuthMetadata();if(await us(t),i||s?.oauthSignIn)return Es(e,!1)},hs=e=>te(ie,se("RevokeToken"),oe(),{...ne,...e}),ms=new nn("Auth");async function gs(e){const t=D.getConfig().Auth?.Cognito;O(t),await Ss(t);let n;try{_t(t),n=!0}catch{n=!1}if(n){const o=new Qt(on);o.setAuthConfig(t);const{type:i}=await ps(t,o,N)??{};if(i==="error")throw new P({name:en,message:"An error occurred when attempting to log out from OAuth provider."})}else N.clearTokens(),await Mt(),be.dispatch("auth",{event:"signedOut"},"Auth",Le)}async function Ss(e){try{const{userPoolEndpoint:t,userPoolId:n,userPoolClientId:o}=e,i=await N.getTokenStore().loadTokens();tn(i),fs(i.accessToken)&&await hs({endpointResolver:f({endpointOverride:t})})({region:I(n),userAgentValue:x(C.SignOut)},{ClientId:o,Token:i.refreshToken})}catch{ms.debug("Client signOut error caught but will proceed with token removal")}}const fs=e=>!!e?.payload?.origin_jti,K=re(null),M=re(!1),k=re(!1),$=re(null),Ae=re(!1),Ce=re(null),ys=()=>{const e=async(s,a)=>{console.log("useAuth.login called with:",{username:s,passwordLength:a.length});try{console.log("Setting loading to true"),k.value=!0,$.value=null,console.log("Calling AWS Cognito signIn...");const r=await os({username:s,password:a});if(console.log("signIn full result:",r),console.log("signIn result:",{isSignedIn:r.isSignedIn}),r.nextStep&&console.log("signIn nextStep:",r.nextStep),r.isSignedIn){console.log("Sign in successful, getting current user...");try{const c=await me();if(console.log("getCurrentUser result:",c),c)return K.value=c,M.value=!0,console.log(":",{user:c,isAuthenticated:M.value}),!0}catch(c){return console.error(":",c),console.log(""),M.value=!0,!0}}else if(r.nextStep?.signInStep==="CONFIRM_SIGN_IN_WITH_NEW_PASSWORD_REQUIRED")return console.log(""),Ce.value=r,Ae.value=!0,"NEEDS_NEW_PASSWORD";return console.log("Sign in failed or isSignedIn is false"),!1}catch(r){return console.error(":",r),r.name==="UserNotFoundException"?$.value="":r.name==="NotAuthorizedException"?$.value="":$.value=r.message||"",!1}finally{console.log("Setting loading to false"),k.value=!1}},t=async()=>{try{k.value=!0,await gs(),K.value=null,M.value=!1,await sn("/login")}catch(s){console.error(":",s),$.value=s.message||""}finally{k.value=!1}},n=async()=>{try{k.value=!0;const s=await me();return s?(K.value=s,M.value=!0,!0):(K.value=null,M.value=!1,!1)}catch(s){return s.name==="UserUnAuthenticatedException"||s.name==="NotAuthorizedException"?(K.value=null,M.value=!1,!1):(console.error(":",s),K.value=null,M.value=!1,!1)}finally{k.value=!1}},o=async s=>{console.log("setNewPassword called");try{if(k.value=!0,$.value=null,!Ce.value)throw new Error("");console.log("Calling confirmSignIn with new password...");const a=await ss({challengeResponse:s});if(console.log("confirmSignIn result:",a),a.isSignedIn){console.log("");try{const r=await me();if(r)return K.value=r,M.value=!0,Ae.value=!1,Ce.value=null,console.log(":",{user:r,isAuthenticated:M.value}),!0}catch(r){return console.error(":",r),M.value=!0,Ae.value=!1,Ce.value=null,!0}}return!1}catch(a){return console.error(":",a),$.value=a.message||"",!1}finally{k.value=!1}},i=async()=>{try{return(await rn()).tokens?.idToken?.toString()||null}catch(s){return console.error("ID:",s),null}};return{user:pe(K),isAuthenticated:pe(M),loading:pe(k),error:pe($),needsNewPassword:pe(Ae),login:e,logout:t,setNewPassword:o,checkAuthStatus:n,getIdToken:i}};export{ys as u};
