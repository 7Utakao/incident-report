import{e as L,r as u,k as S,u as z,c as t,a as s,b as c,w as f,o as l,h as e,l as _,m as b,p as y,t as C,q as A,s as q}from"./BBGXoVXL.js";import{C as D}from"./f9QzHCjA.js";import{B as M}from"./0OkAVhSL.js";import{I as h}from"./C-IanVnj.js";import{u as U}from"./Dzv0W22B.js";const E={class:"min-h-screen bg-background flex items-center justify-center px-4"},I={class:"max-w-md w-full space-y-8"},$={class:"relative"},R=["disabled"],T={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},W={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},H={key:0,class:"text-error text-sm bg-red-50 p-3 rounded-md"},O={key:0},F={key:1},G={class:"relative"},J=["disabled"],K={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Q={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},X={class:"relative"},Y=["disabled"],Z={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ee={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},oe={key:0,class:"text-error text-sm bg-red-50 p-3 rounded-md"},se={key:1,class:"text-error text-sm bg-red-50 p-3 rounded-md"},te={key:0},le={key:1},ce=L({__name:"login",setup(ne){const p=u(""),m=u(""),d=u(""),i=u(""),w=u(!1),k=u(!1),g=u(!1),{login:x,loading:n,error:v,isAuthenticated:V,needsNewPassword:P,setNewPassword:N}=U(),B=async()=>{console.log("handleLogin called - 関数が実行されました"),console.log("Username:",p.value,"Password length:",m.value.length),console.log("Login function:",typeof x);try{console.log("login関数を呼び出し中...");const r=await x(p.value,m.value);console.log("login関数の結果:",r),r===!0?(await A(),console.log("ログイン成功、ナビゲート開始")):console.log(r==="NEEDS_NEW_PASSWORD"?"新しいパスワードの設定が必要です":"ログイン失敗")}catch(r){console.error("handleLogin内でエラー:",r)}},j=async()=>{if(console.log("handleSetNewPassword called"),d.value!==i.value){console.error("パスワードが一致しません");return}try{console.log("setNewPassword関数を呼び出し中...");const r=await N(d.value);console.log("setNewPassword関数の結果:",r),console.log(r?"新しいパスワード設定成功":"新しいパスワード設定失敗")}catch(r){console.error("handleSetNewPassword内でエラー:",r)}};return S(V,async r=>{r&&(console.log("認証状態が更新されました、ナビゲート実行"),await q("/"))},{immediate:!0}),z({title:"ログイン - インシデント報告システム"}),(r,o)=>(l(),t("div",E,[s("div",I,[o[14]||(o[14]=s("div",{class:"text-center"},[s("h1",{class:"text-3xl font-bold text-secondary"},"ログイン"),s("p",{class:"mt-2 text-gray"},"インシデント報告システムにログインしてください")],-1)),c(D,{class:"p-8"},{default:f(()=>[e(P)?(l(),t("form",{key:1,onSubmit:_(j,["prevent"]),class:"space-y-6"},[o[13]||(o[13]=s("div",{class:"text-center mb-4"},[s("h2",{class:"text-lg font-semibold text-secondary"},"新しいパスワードを設定"),s("p",{class:"text-sm text-gray mt-1"}," 初回ログインのため、新しいパスワードを設定してください ")],-1)),s("div",G,[c(h,{modelValue:e(d),"onUpdate:modelValue":o[3]||(o[3]=a=>y(d)?d.value=a:null),type:e(k)?"text":"password",label:"新しいパスワード",placeholder:"新しいパスワードを入力",required:"",disabled:e(n)},null,8,["modelValue","type","disabled"]),s("button",{type:"button",onClick:o[4]||(o[4]=a=>k.value=!e(k)),class:"absolute right-3 top-9 text-gray-500 hover:text-gray-700 focus:outline-none",disabled:e(n)},[e(k)?(l(),t("svg",K,o[9]||(o[9]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"},null,-1)]))):(l(),t("svg",Q,o[10]||(o[10]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])))],8,J)]),s("div",X,[c(h,{modelValue:e(i),"onUpdate:modelValue":o[5]||(o[5]=a=>y(i)?i.value=a:null),type:e(g)?"text":"password",label:"パスワード確認",placeholder:"パスワードを再入力",required:"",disabled:e(n)},null,8,["modelValue","type","disabled"]),s("button",{type:"button",onClick:o[6]||(o[6]=a=>g.value=!e(g)),class:"absolute right-3 top-9 text-gray-500 hover:text-gray-700 focus:outline-none",disabled:e(n)},[e(g)?(l(),t("svg",Z,o[11]||(o[11]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"},null,-1)]))):(l(),t("svg",ee,o[12]||(o[12]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])))],8,Y)]),e(v)?(l(),t("div",oe,C(e(v)),1)):b("",!0),e(d)&&e(i)&&e(d)!==e(i)?(l(),t("div",se," パスワードが一致しません ")):b("",!0),c(M,{type:"submit",variant:"primary",class:"w-full",loading:e(n),disabled:!e(d)||!e(i)||e(d)!==e(i)||e(n)},{default:f(()=>[e(n)?(l(),t("span",te,"設定中...")):(l(),t("span",le,"パスワードを設定"))]),_:1},8,["loading","disabled"])],32)):(l(),t("form",{key:0,onSubmit:_(B,["prevent"]),class:"space-y-6"},[s("div",null,[c(h,{modelValue:e(p),"onUpdate:modelValue":o[0]||(o[0]=a=>y(p)?p.value=a:null),type:"text",label:"ユーザーID",placeholder:"ユーザーIDを入力",required:"",disabled:e(n)},null,8,["modelValue","disabled"])]),s("div",$,[c(h,{modelValue:e(m),"onUpdate:modelValue":o[1]||(o[1]=a=>y(m)?m.value=a:null),type:e(w)?"text":"password",label:"パスワード",placeholder:"パスワードを入力",required:"",disabled:e(n)},null,8,["modelValue","type","disabled"]),s("button",{type:"button",onClick:o[2]||(o[2]=a=>w.value=!e(w)),class:"absolute right-3 top-9 text-gray-500 hover:text-gray-700 focus:outline-none",disabled:e(n)},[e(w)?(l(),t("svg",T,o[7]||(o[7]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"},null,-1)]))):(l(),t("svg",W,o[8]||(o[8]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"},null,-1),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,-1)])))],8,R)]),e(v)?(l(),t("div",H,C(e(v)),1)):b("",!0),c(M,{type:"submit",variant:"primary",class:"w-full",loading:e(n),disabled:!e(p)||!e(m)||e(n)},{default:f(()=>[e(n)?(l(),t("span",O,"ログイン中...")):(l(),t("span",F,"ログイン"))]),_:1},8,["loading","disabled"])],32))]),_:1}),o[15]||(o[15]=s("div",{class:"text-center text-sm text-gray"},[s("p",null,"アカウントをお持ちでない場合は、管理者にお問い合わせください。")],-1))])]))}});export{ce as default};
