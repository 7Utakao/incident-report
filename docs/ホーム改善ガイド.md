# ãƒ›ãƒ¼ãƒ ç”»é¢ æ”¹å–„ã‚¬ã‚¤ãƒ‰ï¼ˆIncident Report Systemï¼‰

> ç›®çš„ï¼š**æ˜ã‚‹ãåˆ†ã‹ã‚Šã‚„ã™ã„ãƒ›ãƒ¼ãƒ **ã«åˆ·æ–°ã—ã€æ•°å­—ã¯**ã™ã¹ã¦å®Ÿãƒ‡ãƒ¼ã‚¿é€£å‹•**ã€‚ä¼šç¤¾ãƒ¬ãƒ™ãƒ«ã¨å€‹äººãƒ¬ãƒ™ãƒ«ã®2æœ¬æŒ‡æ¨™ã‚’å°å…¥ã—ã€å¾ã€…ã«ä¸ŠãŒã‚Šã«ãããªã‚‹ãƒ¬ãƒ™ãƒ«è¨­è¨ˆã‚’æ¡ç”¨ã€‚ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—æ™‚ã¯å½“æ—¥ã ã‘ãŠç¥ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆèŠ±ç«ï¼‰ã‚’è¡¨ç¤ºã™ã‚‹ã€‚

---

## 1. ç”»é¢ä»•æ§˜ï¼ˆå®Œæˆå½¢ï¼‰
- ãƒ’ãƒ¼ãƒ­ãƒ¼ï¼šãƒã‚¹ã‚³ãƒƒãƒˆç”»åƒï¼‹ãƒãƒ–ãƒ«
  - æ–‡è¨€ã¯ 3 ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒ©ãƒ³ãƒ€ãƒ è¡¨ç¤º
    1) ã€Œãƒãƒ¼ãƒ å…¨ä½“ã§å­¦ã³ã€æˆé•·ã—ã¦ã„ãã¾ã™ã€‚ã€
    2) ã€Œä»Šæ—¥ã®å ±å‘Šã¯ X ä»¶ã§ã™ã€‚è¨ˆ Y ä»¶æŠ•ç¨¿ã•ã‚Œã¾ã—ãŸã€‚ã‚ã¨ Z ä»¶ã§ãƒ¬ãƒ™ãƒ«ãŒä¸ŠãŒã‚Šã¾ã™ã€‚ã€
    3) ã€Œã“ã‚“ã«ã¡ã¯ã€‚æ—¥ã€…ã®æ”¹å–„ãƒ»æ°—ã¥ãã‚’å…±æœ‰ã—ã¦ã€ã¿ã‚“ãªã§å‰ã«é€²ã¿ã¾ã—ã‚‡ã†ã€‚ã€
  - **ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—å½“æ—¥**ã¯ä¸Šè¨˜ã®ä»£ã‚ã‚Šã«ã€ŒãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ãƒ¬ãƒ™ãƒ«ãŒä¸ŠãŒã‚Šã¾ã—ãŸ ğŸ†ã€ã‚’å„ªå…ˆè¡¨ç¤º
- ãƒ¬ãƒ™ãƒ«ã‚«ãƒ¼ãƒ‰ï¼š
  - ä¼šç¤¾ãƒ¬ãƒ™ãƒ«ï¼ˆå…¨ç¤¾ã®æŠ•ç¨¿åˆè¨ˆã‚’XPã¨ã—ã¦æ›ç®—ï¼‰
  - å€‹äººãƒ¬ãƒ™ãƒ«ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŠ•ç¨¿åˆè¨ˆã‚’XPã¨ã—ã¦æ›ç®—ï¼‰
  - ãã‚Œãã‚Œï¼š`Lv N ã€ˆç§°å·ã€‰`ã€é€²æ—ãƒãƒ¼ã€æ¬¡ãƒ¬ãƒ™ãƒ«ã¾ã§ã®ä»¶æ•°
- æœ€è¿‘ã®å ±å‘Šï¼šæœ€æ–° 5 ä»¶ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã€ã‚«ãƒ†ã‚´ãƒªã€è¦ç´„ã€ä½œæˆæ—¥ï¼‰
- ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯å‰Šé™¤
- å…¨ä½“ãƒˆãƒ¼ãƒ³ï¼šä»Šã©ãã®æ˜ã‚‹ã„é…è‰²ï¼ˆç™½ / ãƒ‘ã‚¹ãƒ†ãƒ« / è–„ã„ã‚·ãƒ£ãƒ‰ã‚¦ / è§’ä¸¸ï¼‰

> å‚è€ƒï¼šå³å´ã® `Home_demo.html` ã®UIã‚’ Nuxt ãƒšãƒ¼ã‚¸ã«ç§»æ¤ã—ã€ãƒ‡ãƒ¼ã‚¿é€£å‹•ã•ã›ã‚‹ã€‚

---

## 2. ãƒ‡ãƒ¼ã‚¿é€£æºï¼ˆAPI å¥‘ç´„ï¼‰
### 2.1 å¿…é ˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- **ç·ä»¶æ•° / ä»Šæ—¥ä»¶æ•°**
  - `GET /stats/categories?scope=all` â†’ `{ totalReports }`
  - `GET /stats/categories?scope=today&tz=Asia/Tokyo` â†’ `{ totalReports }`
  - â€» æ—¢å­˜ã®é›†è¨ˆAPIã‚’æµç”¨ã€‚ã‚¹ã‚±ãƒ¼ãƒ«æ™‚ã¯ `/stats/summary` ã«åˆ‡ã‚Šå‡ºã—ã‚‚å¯ã€‚
- **æœ€è¿‘ã®å ±å‘Š**
  - `GET /reports?limit=5` â†’ `{ items:[{ id,title,summary,category,categories,createdAt }] }`

### 2.2 ãƒãƒƒãƒ”ãƒ³ã‚°
- ä¼šç¤¾XP = `/stats.categories(scope=all).totalReports`
- å€‹äººXP = `GET /reports?authorId=me&countOnly=true`ï¼ˆãªã‘ã‚Œã°ä¸€æ™‚çš„ã« `/me` ã§äº‹å‰å–å¾—â†’ãƒ•ãƒ­ãƒ³ãƒˆã§ãƒ•ã‚£ãƒ«ã‚¿ï¼‰
- ä»Šæ—¥ä»¶æ•° = `/stats.categories(scope=today)`
- æœ€è¿‘5ä»¶ = `/reports?limit=5`

### 2.3 èªè¨¼
- ãƒ•ãƒ­ãƒ³ãƒˆã¯ **IDãƒˆãƒ¼ã‚¯ãƒ³**ã‚’ `Authorization: Bearer <idToken>` ã§é€ä»˜ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¨åŒã˜ï¼‰

---

## 3. ãƒ¬ãƒ™ãƒ«è¨­è¨ˆï¼ˆä¼šç¤¾ / å€‹äºº å…±é€šï¼‰
### 3.1 ç§°å·ï¼ˆ9æ®µéšï¼‰
1. ã²ã‚ˆã£ã“  
2. ãŸã­ã¾ã  
3. è¦‹ç¿’ã„  
4. ç ”ç©¶è€…  
5. å†’é™ºè€…  
6. é”äºº  
7. å¸«ç¯„  
8. å…ˆå°è€…  
9. ä¼é“å¸«

### 3.2 é€²è¡Œåº¦ï¼ˆå¿…è¦ä»¶æ•°ï¼‰
- ãƒ¬ãƒ™ãƒ« *n â†’ n+1* ã«å¿…è¦ãªä»¶æ•°ï¼š`need(n) = round(5 + n^1.5)`
- ãƒ†ãƒ¼ãƒ–ãƒ«ï¼š
  - 1â†’2: **6**ã€2â†’3: **8**ã€3â†’4: **10**ã€4â†’5: **13**ã€
  - 5â†’6: **16**ã€6â†’7: **20**ã€7â†’8: **24**ã€8â†’9: **28**
- ç´¯ç©åˆ°é”ï¼ˆç›®å®‰ï¼‰ï¼šLv2=6ã€Lv3=14ã€Lv4=24ã€Lv5=37ã€Lv6=53ã€Lv7=73ã€Lv8=97ã€Lv9=125
- ç›´æ„Ÿï¼šåºç›¤ã¯ä¸ŠãŒã‚Šã‚„ã™ãã€å¾ŒåŠã¯æ®µéšçš„ã«é‡ãï¼ˆâ€œå¾ã€…ã«é›£ã—ããªã‚‹â€ï¼‰

### 3.3 å®Ÿè£…æŒ‡é‡
- XP ã¯ã¾ãš **æŠ•ç¨¿ä»¶æ•°**ã®ã¿ã§ç®—å‡ºï¼ˆå°†æ¥ã€ã‚«ãƒ†ã‚´ãƒªå¤šæ§˜æ€§ãƒ»ä»–è€…ã‹ã‚‰ã®ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§åŠ ç‚¹ï¼‰
- ãƒ•ãƒ­ãƒ³ãƒˆè¡¨ç¤ºã¯ `ç¾åœ¨ãƒ¬ãƒ™ãƒ« / ç§°å· / é€²æ—ç‡ / æ¬¡ãƒ¬ãƒ™ãƒ«ã¾ã§ã®æ®‹æ•°`
- ä¼šç¤¾XPï¼šå…¨ä»¶æ•°ã€å€‹äººXPï¼šãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä»¶æ•°

### 3.4 ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—æ¤œçŸ¥
- ã‚µãƒ¼ãƒå´ã§ `levels:{ org:{level,lastLeveledAt}, me:{level,lastLeveledAt} }` ã‚’è¿”ã™ã‹ã€
  ã‚‚ã—ãã¯ãƒ•ãƒ­ãƒ³ãƒˆã§å‰å›ãƒ¬ãƒ™ãƒ«ã‚’ `localStorage` ã«ä¿å­˜ã—ã¦æ¯”è¼ƒ
- **å½“æ—¥å†…**ã«ãƒ¬ãƒ™ãƒ«ãŒä¸ŠãŒã£ãŸã‚‰ã€ãƒã‚¹ã‚³ãƒƒãƒˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’
  `ã€ŒãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ãƒ¬ãƒ™ãƒ«ãŒã€ˆæ—§ã€‰â†’ã€ˆæ–°ã€‰ã«ãªã‚Šã¾ã—ãŸ ğŸ†ã€` ã«å·®ã—æ›¿ãˆï¼ˆå½“æ—¥ 23:59 ã¾ã§ï¼‰

---

## 4. ã‚¢ã‚»ãƒƒãƒˆï¼ˆãƒã‚¹ã‚³ãƒƒãƒˆï¼‰
- ã¾ã‚‹ã„å¯æ„›ã„ã‚­ãƒ£ãƒ©ç”»åƒï¼ˆPNG/SVGï¼‰ã‚’é…ç½®ï¼ˆä»®ï¼šPlacehold ç”»åƒï¼‰ã€‚
- å¾Œã§ç”»åƒç”Ÿæˆï¼ˆä¾‹ï¼šBedrock Stable Diffusion / Firefly ç­‰ï¼‰ã‚’è¡Œã†ã€‚ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¨ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆã¯åˆ¥é€”ãƒ¡ãƒ¢ã€‚

---

## 5. å®Ÿè£…ã‚¿ã‚¹ã‚¯ï¼ˆClineå‘ã‘ï¼‰
1) **API é€£æº**  
- `/stats/categories?scope=all|today` ã‚’å‘¼ã³ã€`totalReports` ã‚’å–å¾—ã€‚ä¼šç¤¾XPã¨ä»Šæ—¥ä»¶æ•°ã«ä½¿ç”¨ã€‚
- `/reports?limit=5` ã‚’å‘¼ã³ã€æœ€è¿‘5ä»¶ã‚’æç”»ã€‚ã‚«ãƒ†ã‚´ãƒªã¯ `category || categories[0]` ã‚’è¡¨ç¤ºã€‚

2) **å€‹äººXP**  
- `/reports?authorId=me&countOnly=true` ãŒç„¡ã‘ã‚Œã°ã€æš«å®šã§ `/reports?limit=50` å–å¾—â†’ãƒ•ãƒ­ãƒ³ãƒˆã§ `authorId===me` ã‚’é›†è¨ˆã€‚
- å°†æ¥ã¯è»½é‡ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸å·®ã—æ›¿ãˆã€‚

3) **ãƒ¬ãƒ™ãƒ«ç®—å‡º**  
- ä¸Šè¨˜ `need(n)` ã‚’ç”¨ã„ã¦ã€XPâ†’ãƒ¬ãƒ™ãƒ«/é€²æ—/æ®‹ä»¶æ•°ã‚’ç®—å‡ºã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’å…±é€šåŒ–ã€‚

4) **ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—æ¼”å‡º**  
- ã‚µãƒ¼ãƒãŒ `lastLeveledAt` ã‚’è¿”ã›ã‚‹å ´åˆã¯ãã‚Œã‚’å„ªå…ˆã€‚ç„¡ã‘ã‚Œã°ãƒ•ãƒ­ãƒ³ãƒˆã§å‰å›ãƒ¬ãƒ™ãƒ«ã‚’ `localStorage('level.org'/'level.me')` ã«ä¿å­˜ã—ã€å½“æ—¥ä¸­ã¯ãŠç¥ã„æ–‡ã‚’è¡¨ç¤ºã€‚

5) **UI çµ„ã¿è¾¼ã¿**  
- `Home_demo.html` ã®ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—/ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ Nuxt ãƒšãƒ¼ã‚¸ã«ç§»æ¤ã€‚
- ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚³ãƒ”ãƒ¼ã¯ä»¥ä¸‹ã®å›ºå®šæ–‡ã«å·®ã—æ›¿ãˆå¯èƒ½ï¼š
  > ç¾å ´ã®ã¤ã¾ãšããƒ»æ°—ã¥ããƒ»æ”¹å–„æ¡ˆã‚’å®‰å…¨ã«åŒ¿ååŒ–ã—ã¦è“„ç©ã—ã€ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«å¯è¦–åŒ–ã—ã¦å­¦ã³åˆã†ç¤¾å†…ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚AI ãŒè¦ç´„ã¨ã‚¿ã‚°ä»˜ã‘ã‚’è£œåŠ©ã—ã¾ã™ã€‚

6) **ãƒ†ã‚¹ãƒˆ**  
- æ–°è¦æŠ•ç¨¿ã‚’ 1â†’2 ä»¶è¿½åŠ ã—ã€å€‹äºº/ä¼šç¤¾ã®ãƒãƒ¼ã¨â€œæ®‹ã‚Šä»¶æ•°â€ãŒå¢—æ¸›ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã€‚
- å½“æ—¥ã«ãƒ¬ãƒ™ãƒ«å¢ƒç•Œã‚’è·¨ããƒ†ã‚¹ãƒˆã§ãŠç¥ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã‚‹ã“ã¨ã‚’ç¢ºèªã€‚

---

## 6. å—ã‘å…¥ã‚ŒåŸºæº–ï¼ˆACï¼‰
- [ ] ãƒ›ãƒ¼ãƒ ã®æ•°å­—ãŒ **ã™ã¹ã¦ API ç”±æ¥**ï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ç„¡ã—ï¼‰
- [ ] ä¼šç¤¾/å€‹äººã® 2 æœ¬ãƒãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã€**æ®‹ä»¶æ•°**ã¨**é€²æ—ç‡**ãŒæœŸå¾…é€šã‚Š
- [ ] æœ€è¿‘5ä»¶ãŒ DB ã®æœ€æ–°ã¨ä¸€è‡´
- [ ] ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—å½“æ—¥ã€ãƒã‚¹ã‚³ãƒƒãƒˆãŒç¥è¾ï¼ˆğŸ†ï¼‰ã‚’å‡ºã™
- [ ] æ˜ã‚‹ã„é…è‰²ã¨ç¾ä»£çš„ãªä½™ç™½ãƒ»è§’ä¸¸ãƒ»ã‚·ãƒ£ãƒ‰ã‚¦ã§çµ±ä¸€

---

## 7. ã‚ˆãã‚ã‚‹è½ã¨ã—ç©´
- ä»Šæ—¥ä»¶æ•°ã®é›†è¨ˆã¯ **ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ï¼ˆAsia/Tokyoï¼‰** ã‚’å¿…ãšè€ƒæ…®
- ã‚«ãƒ†ã‚´ãƒªãŒé…åˆ—ã®ã¨ãã®è¡¨ç¤ºå„ªå…ˆé †ä½
- ãƒ¬ãƒ™ãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«ã®å¢ƒç•Œï¼ˆã¡ã‚‡ã†ã©0ä»¶ã§ä¸ŠãŒã‚‹æ™‚ï¼‰ã¯ `>=` åˆ¤å®šã§ãƒã‚°ã‚‰ãªã„ã‚ˆã†ã«

---

## 8. å®Œäº†å®šç¾©ï¼ˆDoDï¼‰
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆï¼šãƒ›ãƒ¼ãƒ å…¨æ™¯ã€ãƒ¬ãƒ™ãƒ«2æœ¬ã€æœ€è¿‘ã®å ±å‘Š
- `/stats/categories?scope=all|today` ã¨ `/reports?limit=5` ã® JSON ã‚’æ·»ä»˜
- ä»•æ§˜ãƒ»UIå·®åˆ†ãŒ PR ã«åæ˜ ã•ã‚Œã¦ã„ã‚‹ã“ã¨

